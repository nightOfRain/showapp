<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title></title>
		<link href="js/lib/bootstrap3.0/bootstrap.css" rel="stylesheet">	
		<link rel="stylesheet" href="hello-mui/css/mui.min.css">
		<link rel="stylesheet" href="hello-mui/css/app.css">
		<link rel="stylesheet" href="hello-mui/css/iconfont.css">	
		<link href="css/lib/zzlcss/menu11.css" rel="stylesheet">
		<link href="css/common.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="hello-mui/css/icons-extra.css" />
		<script type="text/javascript" src="js/lib/jQuery/jquery-2.0.0.min.js"></script>
		        <script type="text/javascript" src="js/lib/zzljs/menu11.js"></script>
		<script type="text/javascript" src="js/lib/zzljs/menu11_com.js"></script>
       
		<script type="text/javascript" src="js/lib/bootstrap3.0/bootstrap.min.js"></script>
		<script type="text/javascript" src="cordova.js"></script>
		<script src="js/index.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" src="js/jquery.md5.js"></script>
	</head>
	<style>
		*{font-family:"微软雅黑"; margin:0; padding:0; border:0; font-size:14px;color:white;}
		html,body{height:100%; width:100%;;}
		/*--正在加载--*/
		.showframe{
			width: 100%;
			height: 100%;
			border: none;
			display: none;
		}
	
		@-webkit-keyframes am-rotate2{
			from{background-position:0 0}
			to{background-position:-444px 0}
		}
		.popup{
			width:100%;height:100%;z-index:1010;position:absolute;left:0;top:0;background:rgba(255,255,255,0.3);
		}
		.centerdiv{
			position:relative;left:50%;top:50%;width:0px;height:0px;z-index:1020;
		}
		
		body { 
			margin: 0; 
			padding: 0; 
			background-attachment: fixed; /* prevent screen flash in IE6 */ 
		} 
		div,ul{margin: 0;padding: 0;} 
	    
	    
	
	    .div_process{
       
	        z-index:9999;background-color:#FFF0F5; width:100%; height:50px; position: fixed;  top:300px;text-align:center;
	        
	    }
	    
	    .div_back{
	        
	        z-index:9998;background-color:rgba(01,01,01,0.1);width:100%;height:100%;position: fixed;top:0px;
	    }
	
		.body_login{
			background:url(img/bg.png) repeat-x;
			
			z-index:9998;width:100%;height:100%;position: fixed;top:0px;
		}
		nav ul li {
			width: 20%;
			float: left;
			margin-left: 0;
			margin-right: 0;
			padding: 0;
			background-color:#f4f4f4;
		
		}
	</style>

<script type="text/javascript">
	var bottomNav_H,top_H=50; //页面属性
	var win_H=document.documentElement.clientHeight;//页面属性
	var spacing;
	var pagearr=[]; //存放页面的栈
 	var coordinate; //存当前坐标
 	var address_gps; //存放当前地址
	var data={}; //全局变量，用于临时存放交互报文
	var debug_flag = true; //debug 日志开关，测试为true ,上线为false
	var imgpath="http://"+IP+":"+PORT+"/static/"; //远程图片路径
	var localpath = "file:///storage/emulated/0/Android/data/com.nantian.showapp_Android/cache/";//沙盒路径
	var open_flag='0';//图片预览标志，安卓手机按back键时图片预览关闭插件和页面返回，这里加开关控制
	var edit_flag='0';//页面是否处于编辑状态，编辑页面时防止误按back键
	var fun_now; //用于跨函数存放回调方法
	var tmp_iframe; //用来处理定位模块的iframe临时变量

	document.addEventListener("DOMContentLoaded", initial);
	function initial() {
		top.data = '';
		/*是否登录 0-未登录 1-已登录*/
		localStorage.setItem("acount", "0");

		Settings = get_settings();
		
		if(isEmptyObject(Settings)){//不存在settings;
			var obj = {};
			obj.loginState = false;//登陆状态
			obj.autoLogin = false;//是否自动登陆
			obj.loginMode = 'pass';//'pass'-用户密码 'lock'-手势
			obj.gestures = {}; //手势密码
			obj.userId = ''; //用户名
			obj.passWd = '';//密码
			Settings = obj;
			set_settings(Settings);
		}else{

			//登陆方式判断
	        if(Settings.loginMode == 'pass'){
	        	flag_mode = 0;
	        	$(".mui-pull-right").removeClass('icon-jianpan');
	        	$(".mui-pull-right").addClass('icon-shoushi');
	    		
	        }else{
	        	flag_mode = 1;
	        	$(".mui-pull-right").removeClass('icon-shoushi');
	    		$(".mui-pull-right").addClass('icon-jianpan');
	        }
	        if(Settings.autoLogin){
	        	$("input[type=checkbox]").attr("checked", "checked");
	        	//账号密码自动填充
		        if(!isEmpty(Settings.userId)){
		        	$("#userid").val(Settings.userId);	        	
		        	$("#mm").val(Settings.passWd);
		        	
		        	if(Settings.autoLogin){
		        		
		        		login();
		        	}
		        }
	        }
	        
		}
        

	}

	//调用系统拨号模块
    function call_phone(phoneno){
    	CallPhone.show(phoneno);
    }
    
	//开始加载
    function start_process(){
    	NTUI.beginLoaded();    	
    }
    //结束加载
    function stop_process(){
    	NTUI.onLoaded();
    }
    
    //获取地理位置
	function getmylocation(fun){
		BaiduLocation.getCurrentPosition(fun, function(msg){
			writelog("BaiduLocation failed:"+msg);
		});
	}
    
    //获取地理位置
    function getmylocation_r(fun){		
		BaiduLocation.getCurrentPosition(fun, function(msg){
			writelog("BaiduLocation failed:"+msg);
		});
	}
    //根据 key 返回 对象数组data 里 对象.value==key的 对象的text
    function getValue_by_key(data, key){
    	var retinfo;
    	 $(data).each(function(i,dom){
    		 console.log("value="+dom.value+";text="+dom.text);
      	   	if(dom.value == key){
      	   		console.log("get it = "+dom.text);
      	   		retinfo = dom.text;
      	   	}         
         });
    	 return retinfo;
    }
    
    //检查版本信息
    function App_Update(){
    	AppUpdate.CheckUpdate(function(msg){
			top.alertInfo('请求成功'+msg,'','温馨提示','确认');
		}, function(msg){
			top.alertInfo('请求失败'+msg,'','温馨提示','确认');
		});
    }
    //系统alert
    function alertInfo(message){
    	navigator.notification.alert(message, null, "现场检查APP", "确定");
    }
    //系统confirm
    function confirmInfo(message, resultCallback){
    	
    	navigator.notification.confirm(message, resultCallback, "现场检查APP", ["确定","取消"]);
    }
    
    //自定义confirm
 	function confirmInfo_new(message, resultCallback){
    	
    	navigator.notification.confirm(message, resultCallback, "现场检查APP", ["继续录入","重新开始"]);
    }

	//调用相册选择图片
	function getPictures(callback){
		fun_now = callback;
		ImagePicker.show(callback,function(msg){
	    	 alert("error"+msg);
	     });
	}
	//调用手机相机，拍照后直接上传
    function capturePhoto_noUpload(callback) {
    	fun_now = callback;
    	navigator.camera.getPicture(callback,function fail(msg){
    		console.log("fail:"+msg);
    	},{});

    }
	
 	//调用手机相机，拍照后直接上传
    function capturePhoto(callback) 
    	fun_now = callback;
    	navigator.camera.getPicture(uploadPhoto,function fail(msg){
    		console.log("fail:"+msg);
    	},{});

    }
 	
  //调用手机相册，选择后直接上传
    function capturePhoto_photo(callback) {
    	fun_now = callback;
   
/*      	var options={
	    	quality:50,                                       //保存图像的质量，范围0-100
	    	destinationType:Camera.DestinationType.FILE_URI,  //返回值格式:DATA_URL=0,返回作为base64编码字符串；FILE_URL=1，返回图像的URL；NATIVE_RUL=2，返回图像本机URL
	    	sourceType:0,       //设置图片来源：PHOTOLIBRARY=0，相机拍照=1，
	    	allowEdit:false,                                   //选择图片前是否允许编辑
	    	encodingType:Camera.EncodingType.JPEG,            //JPEN = 0，PNG = 1
	    	targetWidth:-1,                                  //缩放图像的宽度（像素）
	    	targetHeight:-1,                                 //缩放图像的高度（像素）
	    	popoverOptions:CameraPopoverOptions,              //ios,iPad弹出位置
	    	saveToPhotoAlbum:true,                            //是否保存到相册
	    	correctOrientation:true                           //设置摄像机拍摄的图像是否为正确的方向
    	}; 
 */
    	navigator.camera.getPictureBylib(uploadPhoto,function fail(msg){
    		console.log("fail:"+msg);
    	},{});

    }
 

//文件上传
    function uploadPhoto(imgurl) {
        
        var options = new FileUploadOptions();
        
        
        options.fileKey = "fileAddPic";//用于设置参数，对应form表单里控件的name属性，这是关键，废了一天时间，完全是因为这里，这里的参数名字，和表单提交的form对应
 

		writelog("uploadPhoto="+imgurl);
        
        var imageURI = imgurl;
        options.fileName = imageURI.substr(imageURI.lastIndexOf('/') + 1);
        options.mimeType = "image/jpeg";

        //这里的uri根据自己的需求设定，是一个接收上传图片的地址
 		var fileno = localStorage.getItem("file_path");
 		console.log("fileno = " + fileno);
     
 		//图片本地路径
        image_local_url = imageURI;

         var uri = encodeURI("http://"+IP+":"+PORT+"/app/6030?fileno="+fileno); 
       
        options.chunkedMode = false;
        
        process_show();
        ft = new FileTransfer();
        ft.onprogress = showUploadingProgress;
      
        ft.upload(imageURI, uri, win, onFail, options);

    }
    function win(r) {
		process_dismiss();
		
        var response = r.response;
        
 		var message = eval("(" + r.response + ")");
		//图片上传成功后回调页面方法
 		
		fun_now(image_local_url, message.msg);
		
        //以下是三个默认的返回参数
 		localStorage.getItem("server_url");
 		console.log("img_url = " + message.msg);
        console.log("Code = " + r.responseCode);
 
        console.log("Response = " + r.response);
 
        console.log("Sent = " + r.bytesSent);

 
    }
    //判断对象是否为空
    function isEmpty(obj) {

		if(!obj || obj == 'NULL' || obj == '' || obj== 'undefined') {　　　　　　　　　
		  return true;
		}
		
		if(Array.prototype.isPrototypeOf(obj) && obj.length == 0) {
			　　　return true;
		}
		
		if(Object.prototype.isPrototypeOf(obj) && Object.keys(obj).length == 0) { 
			
			　return true; 　　　
		}
		return false; 
	}
    
    //判断是否空对象
    function isEmptyObject(e) {  
	    var t;  
	    for (t in e)  
	        return !1;  
	    return !0  
	} 


    function win(r) {
		process_dismiss();
		
        var response = r.response;
        
 		var message = eval("(" + r.response + ")");
		//图片上传成功后回调页面方法
 		
		fun_now(image_local_url, message.msg);
		
        //以下是三个默认的返回参数
 		localStorage.getItem("server_url");
 		console.log("img_url = " + message.msg);
        console.log("Code = " + r.responseCode);
 
        console.log("Response = " + r.response);
 
        console.log("Sent = " + r.bytesSent);

 
    }
    function onFail(message) {
    	process_dismiss();
       //  alert('Failed because: ' + message);
       alertInfo("图片上传失败")
  
     }
    var errCount=0;
    function fail(error) {
    process_dismiss();
  
        console.log("upload error source " + error.source);
 
        console.log("upload error target " + error.target);
 
    }
  //  window.resolveLocalFileSystemURI(imageURI, onResolveSuccess, onError);
    
    
  //图片上传提示打开
    function process_show(){

       $(".div_back").attr("style", "display:black");
        $("p").html("图片上传中,请等待片刻....");
        
    }

    //图片上传提示关闭
    function process_dismiss(){
        
        $(".div_back").attr("style", "display:none");
        
    } 
    
	// 显示上传进度
	function showUploadingProgress( progressEvt){
	
	    if( progressEvt.lengthComputable ){
	        //已经上传
	        var loaded=progressEvt.loaded;
	        //文件总长度
	        var total=progressEvt.total;
	        //计算百分比，用于显示进度条
	        var percent=parseInt((loaded/total)*100);
	        
	       // console.log("percent = " + percent);
	        loaded=(loaded/1024/1024).toFixed(2);
	        total=(total/1024/1024).toFixed(2);
	        $('#process_info').html("已上传:"+loaded+'M/'+"(共)"+total+'M');
	        $('.upload_current_process').css({'width':percent+'%'});
	
	    }
	}
	
	//写日志
    function writelog(str){
    	if(debug_flag){
    		console.log(str);
    	}
    	
    }
	
    function onResolveSuccess(fileEntry){
         
         alertInfo(fileEntry.fullPath);
     }
    
     function onError(error) { 

         toLog("error code: "+ error.code);

     };
 
	//调用主页面的方法
    function update_address(address){
    	
    	mainFrame1.window.update_address(address);
    }    

    function login(){
    	
    	//与原生代码共享变量池
    	NTParameter.getValue( function a(msg){
        	localStorage.setItem("phoneid", msg);
			var id=msg;
			var userid=$("#userid").val().toLowerCase();
			var pwd = $("#pwd").val();

			
		
			var data = {
					userid:userid,
					password:$.md5(pwd),
					serinum:id,
					type:'0'
			};
			Http_ajax(function(msg){
				top.writelog("login="+msg);
				var json = eval("("+msg+")")
	        	
				//保存登录信息
				localStorage.setItem("login_info", msg);
	        	if(json.stat == 0){
	        		$(".body_login").hide();
	        		localStorage.setItem("login_stat", '1');
	        		localStorage.setItem("user_id", userid);
	        		localStorage.setItem("password", pwd);
	        		localStorage.setItem("serinum", id);					
	
					head_url = json.data.headImg;
					user_name = json.data.accountName;
					inst_name = json.data.orgnName;
					myLevel = json.data.userType;
					localStorage.setItem("headImg", json.data.headImg);
					localStorage.setItem("accountName", json.data.accountName);
					localStorage.setItem("orgnName", json.data.orgnName);
					localStorage.setItem("user_type", json.data.userType);
					localStorage.setItem("telNo", json.data.telNo);
					localStorage.setItem("cityName", json.data.cityName);
					localStorage.setItem("email", json.data.email);
					var token = json.data.token;
					NTParameter.addValue(null,null, "userid", userid);
					NTParameter.addValue(null,null, "token", token);
				
					//初始化主页
					mainFrame1.window.initPage();
					
					//Jpush注册
					Jpush_init(userid.toLowerCase());
					
	        	}else{
	        		
	        		alertInfo("登陆失败："+json.msg);
	        	}
	        	show_nav();
				stop_process();
			}, "app/6001", data);
			
			
		}, null, "serinum");
    }
    
    //跟新地图模块，对应页面是map_header,所有页面的地理位置都是用同一的页面map_header.html,是用iframe 加载在需要的页面
    function update_map_address(info){
    	tmp_iframe.window.update_address(info);
    }
    //调用摄像设备
    function get_video(){
    	NTCamera.showVideo(
    			function(path){
    			alert(path);
    			},
    			function(error){
    			alert(error);
    			},
    			get_fileno(),
    			'10',
    			'0',
    			'0'
    			);

    }
    
   	//调用二维码
    function QR_code(callback){
    	NTCamera.showQR(
    			callback,
    			function(error){
    			alert(error);
    			}
    			)

    }
   	
   	//调用手机浏览器--太丑了，这个插件不使用，还是得自己写
    function browser(url){
    	NTCallBrowser.callBrowser(function(msg){
    		alert("sucess="+msg);
    	}, function(error){
    		alert("error="+error)
    	}, url);
    }
   	
   	//退出APP，IOS系统不支持
    function exitApp(){
    	localStorage.setItem("login_stat", "0");
    		navigator.app.exitApp(); 
    }
    
   	//把数据直接存入缓存（原生系统可以直接读取，和原生交互使用）
    function add_value_android(successCallback,failCallback, name, value){
    	NTParameter.addValue(successCallback, failCallback, name, value);
    }
  //把数据从缓存取出（可以直接读取原生数据，和原生交互使用）
    function get_value_android(successCallback,failCallback, name){
    	NTParameter.getValue(successCallback, failCallback, name);
    }
    function hide_nav(){
    	$("#host").hide();
    }
    function show_nav(){
    	$("#host").show();
    }
    
    //获取原生设备唯一编号
	function get_serinum(){
		var serinum;
		NTParameter.getValue( function a(msg){
        	localStorage.setItem("serinum", msg);	
		}, null, "serinum");
		
	}
	
	//Jpush 初始化插件
    function Jpush_init(phoneno){
		writelog("phone="+phoneno);
    	var alias = [];
    	alias.push(phoneno);

        JPushPlugin.setAlias(alias);
    }
	
	
	
	//读服务器xml文件 ， 可以用于处理一些APP相对固定又每次都要使用的基本信息
    function parseXML(){  
        
        $.ajax({
		      url:'http://59.172.63.26:7080/static/appinfo.xml',
		      type: 'GET',
		      dataType: 'xml',
		      timeout: 1000,
		      cache:false,
		      error: function(xml){
		        alert("error:"+xml);
		      },
		      success: function(xml){
		 					console.log("xml="+xmlToString(xml));
		 					var to = xml.getElementsByTagName("to")[0].firstChild.nodeValue; 
		 					var from = xml.getElementsByTagName("from")[0].firstChild.nodeValue; 
		 					var headding = xml.getElementsByTagName("body")[0].childNodes[0].nodeValue; 
		 			writelog("from:"+from+";to:"+to+";headding="+headding);
		      }
		});
    }
	
	//把XML转换成String
    function xmlToString(xmlData) { 

        var xmlString;
        //IE
        if (window.ActiveXObject){
            xmlString = xmlData.xml;
        }
        // code for Mozilla, Firefox, Opera, etc.
        else{
            xmlString = (new XMLSerializer()).serializeToString(xmlData);
        }
        return xmlString;
    }
    
	//刷新主页
    function menu_refresh(){
    	mainFrame1.window.initPage();
    }

  //统一通信接口
    function http_comm(trancode, data, succCallback){
        start_process();
      
        writelog(trancode+" send: "+JSON.stringify(data));
        $.ajax({
            type : "post",
            timeout: 10000,
            url: "http://"+IP+":"+PORT+"/app/"+trancode,        
            data : data,
            datatype : "application/json",
            success : function(msg){
            	stop_process();
                if(msg == null){
                    alertInfo("服务器处理异常");
                    return;
                }
                writelog(trancode+" recv: "+JSON.stringify(msg));
                var msg = typeof msg == 'object' ? JSON.stringify(msg) : msg;
                //var msg = msg.replace(/null/g, '\'\'');
                succCallback(msg);
                },
            error:function(msg){
         	  stop_process();
         	 writelog(trancode+" error recv: "+JSON.stringify(msg));
         	   alertInfo('交易失败');
            }
            });


    }

</script>
	<body>
		<!-- 绑定底部导航 -->
		<div class="container-fluid" >
			<div class="row">
				<div class="col-lg-12  col-xs-12 ">
					<div component-role="swich_page" class="bottom" >
						<iframe name="mainFrame1" id="mainFrame1"  src="menu.html" class="showframe" style="display: block;">
						</iframe>											
						<iframe name="mainFrame2" id="mainFrame2" src="list.html" class="showframe">
						</iframe>
						<iframe name="mainFrame3" id="mainFrame3" src="yaohao_list.html" class="showframe">
						</iframe>
						<iframe name="mainFrame4" id="mainFrame4" src="survey_list.html" class="showframe">
						</iframe>
						<iframe name="mainFrame6" id="mainFrame6" src="setting.html" class="showframe">
						</iframe> 	
					</div>
				</div>
			</div>
			
		
		<!-- 底部导航 -->
		<div class="row" id="host"  style="display:none">
				<div class="col-lg-12 col-xs-12 ">
					<div component-role="bottomNav" class="bottomNav">					
						<div class="nvbarclass">					
							<ul>
								<li>									
									<a ind="1" class="navbar-btn navbar-btn-active" style="background-color:#f3f3f3;padding-top:8px;">										
										<span class="mui-icon mui-icon-home" style="font-size:24px;"></span>
										<span style="margin-top:-6px;">现场检查</span>
									</a>																		
								</li>
								<li>
									<a ind="2" class="navbar-btn" style="background-color:#f3f3f3;padding-top:8px;">										
										<span  class="mui-icon mui-icon-email" style="font-size:24px;"></span>
										<span style="margin-top:-6px;">检查记录</span>
									</a>   
								</li>
								<li>
									<a ind="3" class="navbar-btn" style="background-color:#f3f3f3;padding-top:8px;">										
										<span  class="mui-icon-extra mui-icon-extra-computer" style="font-size:24px;"></span>
										<span style="margin-top:-6px;">评估摇号</span>
									</a>   
								</li>
								<li>
									<a ind="4" class="navbar-btn" style="background-color:#f3f3f3;padding-top:8px;">										
										<span  class="mui-icon mui-icon-map" style="font-size:24px;"></span>
										<span style="margin-top:-6px;">押品评估</span>
									</a>   
								</li>
								<li>
									<a ind="6"  class="navbar-btn" style="background-color:#f3f3f3;padding-top:8px;">
										<span class="mui-icon mui-icon-gear" style="font-size:24px;"></span>
										<span style="margin-top:-6px;">个人设置</span>
									</a>   
								</li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- 上传进度页面 -->
		<div class='div_back' style="display:none;">
		    <div class='div_process'>
		        <p style="width:100%"></p>
		        <div class="upload_process_bar">
		            <div class="upload_current_process"></div>
		        </div>
		        <div id="process_info"></div>
		    </div>
		</div>
		<!-- 要写个好看的登陆界面 -->
		<div class="body_login" style="display:black">
			<div id="sky"></div>
			<div id="head"></div>
			<div id="middle" >
			
				<ul style="text-align: center;">
				<li style="font-size: 36px;color:1291A9;">风险管理APP</li>
					<li style="border-bottom: 1px solid #ffffff;width:60%;margin-left:20%;margin-top:40px;height:40px;">		
					<div class="user_div"></div>							
						<input type="text"   class="inp_text_new" style="font-size: 0.8em;" placeholder="请输入用户名" id="userid"/>				
					</li>
					<li style="border-bottom: 1px solid #ffffff;width:60%;margin-left:20%;height:40px;">	
					<div class="pass_div"></div>			
							<input type="password"  class="inp_text_new" style="font-size: 0.8em;" placeholder="请输入密码" id="pwd"/>				
					</li>
					<li style="border-bottom: 0px solid #ffffff;width:60%;margin-left:20%;"><button id="login" style="width:100%;padding:10px;" onclick="login();">立即登录</button></li>
				</ul>
				<p style="font-size:0.7em;color:#999;margin-top:10px;">NOTE：请使用员工账号登陆，若提示设备号不匹配，请联系管理员</p>
			</div>
			 
			<div id="footer">
				
				<a>Version 1.1.2</a><br>
				 
				
				<a>© 2017 兴业银行武汉分行  All rights reserved.</a>
			</div>
			
		</div>
	</body>

</html>