<!DOCTYPE html>
<html>
    <head>
    		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title></title>
		<link href="js/lib/bootstrap3.0/bootstrap.css" rel="stylesheet">		
		<link href="css/lib/zzlcss/menu11.css" rel="stylesheet">
	
        <link rel="stylesheet" href="css/frozen.css">
        <link rel="stylesheet" href="css/common.css">
        <link rel="stylesheet" href="css/demo.css">
        <link rel="stylesheet" type="text/css" href="css/aui/aui.css" />
		<link rel="stylesheet" type="text/css" href="css/aui/aui.2.0.css" />
		<link rel="stylesheet" type="text/css" href="css/aui/api.css" />
		<link rel="stylesheet" type="text/css" href="css/aui/aui-list-swipe.css" />
		<link rel="stylesheet" type="text/css" href="css/aui/aui-flex.css" />
		
<link rel="stylesheet" href="css/iconfont.css">
<link rel="stylesheet prefetch" href="css/photoswipe.css">
<link rel="stylesheet prefetch" href="css/default-skin/default-skin.css">
		<script type="text/javascript" src="js/lib/jQuery/jquery-2.0.0.min.js"></script>
		<script type="text/javascript" src="js/lib/bootstrap3.0/bootstrap.min.js"></script>
		<script type="text/javascript" src="js/lib/zzljs/menu11_com.js"></script>
		
        <script src="lib/zepto.min.js"></script>
        <script src="js/frozen.js"></script>
        <script src="js/index.js" type="text/javascript" charset="utf-8"></script>
        <style>
           
             html, body {
                 position: relative;
                 height: 100%;
             }
         body {
             background: #fff;
             font-family: Helvetica Neue, Helvetica, Arial, sans-serif;
             font-size: 14px;
             color:#000;
             margin: 0;
             padding: 0;
         }
       
        	.img_lit{
                      
                        width: 80px;
                       	height: 80px;
                        
                    }
         	 

			
        </style>
 		<script type="text/javascript">
 		var fileno;
 		var  line_flag = 1;
		var myArray = new Array(); 
		var myArray_offline = new Array(); 
		var other_des='';
		var beltline_flag=1;
		var logistics_flag=1;
		var office_flag=1;
		var wandp_flag=1;
		var stock_flag=1;
		var process_flag=1;
		
		$(function() {
			//调整map高度
			var thisURL = document.URL; 
			
			localStorage.setItem("thisURL", thisURL);
		//	top.offline_flag = 0;
			
			fileno = localStorage.getItem("fileno");
			//选择器控制
			$("input[name=office_checkbox]").click(function(){
					if($(this).prop("checked")) {
						office_flag = 1;
					  	$(".office_div").show();
					  	
					}else{
						$(".office_div").hide();				   		
						office_flag = 0;
					}
					
				 });
			$("input[name=line_checkbox]").click(function(){
				if($(this).prop("checked")) {
					beltline_flag = 1;
				  	$(".line_div").show();
				  	
				}else{
					$(".line_div").hide();				   		
					beltline_flag = 0;
				}
				
			 });
			$("input[name=stock_checkbox]").click(function(){
				if($(this).prop("checked")) {
					stock_flag = 1;
				  	$(".stock_div").show();
				  	
				}else{
					$(".stock_div").hide();				   		
					stock_flag = 0;
				}
				
			 });
			$("input[name=process_checkbox]").click(function(){
				if($(this).prop("checked")) {
					process_flag = 1;
				  	$(".process_div").show();
				  	
				}else{
					$(".process_div").hide();				   		
					process_flag = 0;
				}
				
			 });
			$("input[name=wandp_checkbox]").click(function(){
				if($(this).prop("checked")) {
					wandp_flag = 1;
				  	$(".wandp_div").show();
				  	
				}else{
					$(".wandp_div").hide();				   		
					wandp_flag = 0;
				}
				
			 });
			$("input[name=logistics_checkbox]").click(function(){
				if($(this).prop("checked")) {
					logistics_flag = 1;
				  	$(".logistics_div").show();
				  	
				}else{
					$(".logistics_div").hide();				   		
					logistics_flag = 0;
				}
				
			 });
			
			//other checkbox
			$("input[name=other_checkbox]").click(function(){
			
				 switch($(this).attr("id")){
					 case "box_1":
						  
					  		other_des+="出入库记录  ";
					   break;
					  case "box_2":
						  
					  		other_des+="车位  ";
					   break;
					  case "box_3":
						 
					  		other_des+="车库  ";
					   break;
					  case "box_4":
						  
					  		other_des+="人口出入情况  ";
					   break;
					  case "box_5":
						  
					  		other_des+="上下班人流  ";
					   break;
					  case "box_6":
						  
					  		other_des+="其他";
					   break;
					  default:
					   break;
				 }
				$("#other_des").val(other_des);
				
			});
			

			//初始化多维数组
			for(var i = 0; i < 8; i++){
			//	myArray[i] = new Array();
				myArray_offline[i] = new Array();
			}
		

			initPage();
		});
		
		function initPage(){
			if(top.data.check_step_two){
				
				var data = top.data.check_step_two;
    			office_flag = data.office_flag;
    			if(office_flag == 0){
    				
    				$(".office_div").hide();
    			}else{
    				$("input[name=office_checkbox]").attr("checked", "checked");
    				$(".office_div").show();
    			}
    			
    			beltline_flag = data.beltline_flag;
    			if(beltline_flag == 0){
    				
    				$(".line_div").hide();
    			}else{
    				$("input[name=line_checkbox]").attr("checked", "checked");
    				$(".line_div").show();
    			}
    			
    			stock_flag = data.stock_flag;
    			if(stock_flag == 0){
    				
    				$(".stock_div").hide();
    			}else{
    				$("input[name=stock_checkbox]").attr("checked", "checked");
    				$(".stock_div").show();
    			}
    			
    			process_flag = data.process_flag;
    			if(process_flag == 0){
    				
    				$(".process_div").hide();
    			}else{
    				$("input[name=process_checkbox]").attr("checked", "checked");
    				$(".process_div").show();
    			}
    			
    			wandp_flag = data.wandp_flag;
    			if(wandp_flag == 0){
    				
    				$(".wandp_div").hide();
    			}else{
    				$("input[name=wandp_checkbox]").attr("checked", "checked");
    				$(".wandp_div").show();
    			}
    			
    			logistics_flag = data.logistics_flag;
    			if(logistics_flag == 0){
    				
    				$(".logistics_div").hide();
    			}else{
    				$("input[name=logistics_checkbox]").attr("checked", "checked");
    				$(".logistics_div").show();
    			}
    			
    			$("#office_des").val(data.office_des);
    			
    			$("#beltline_des").val(data.beltline_des);
    			
    			$("#stock_des").val(data.stock_des);
    			
    			$("#process_des").val(data.process_des);
    			
    			$("#wandp_des").val(data.wandp_des);
    			
    			$("#logistics_des").val(data.logistics_des);
    			
    			$("#other_des").val(data.other_des);//这个怎么组成还要考虑    
    			 
    
    				myArray_offline[1] = data.office_img.split('|');
        			myArray_offline[2] = data.beltline_img.split('|');
        			myArray_offline[3] = data.stock_img.split('|');
        			myArray_offline[4] = data.process_img.split('|');
        			myArray_offline[5] = data.wandp_img.split('|');
        			myArray_offline[6] = data.logistics_img.split('|');
        			myArray_offline[7] = data.other_img.split('|');
        			
        			var file_path = localStorage.getItem("group_code");
        			for(var i = 1; i < 8; i++){
        				
        				for(var j = 0; j < myArray_offline[i].length; j++){
        					if(myArray_offline[i][j].length > 0){        						        						
        						var imgurl =  myArray_offline[i][j];          						        						     					
            					add_pic_init(imgurl, i);
        					}else{
        						myArray_offline[i].splice(j,1);
        					}        					        					
        				}
        			}
    			   			    			
			}else{
				$("input[name=office_checkbox]").attr("checked", "checked");
				$("input[name=line_checkbox]").attr("checked", "checked");
				$("input[name=stock_checkbox]").attr("checked", "checked");
				$("input[name=process_checkbox]").attr("checked", "checked");
				$("input[name=wandp_checkbox]").attr("checked", "checked");
				$("input[name=logistics_checkbox]").attr("checked", "checked");
			}
		}
		
		function pz(flag){

          	line_flag = flag;
			top.capturePhoto_offline();
        }
		
		function offline_done(local_url){
			//为对应数组添加元素
			myArray_offline[line_flag].push(local_url);
			
			var gallery = document.getElementById('gallery_'+line_flag);
			
			var figure = document.createElement("figure");
			figure.setAttribute("class", "aui-col-xs-3");
			
			var div = document.createElement("div");
			div.setAttribute("class", "divcss5");
		
			var a = document.createElement("a");
			a.setAttribute("href", local_url);
			var img = document.createElement("img");
			img.src = local_url;
			checkPicurl(img.src);
			var figcaption = document.createElement("figcaption");
		
			a.appendChild(img);
			div.appendChild(a);
			
			figure.appendChild(div);
			figure.appendChild(figcaption)
		    gallery.appendChild(figure);
		}

		function add_pic_init(server_url, num){

			var gallery = document.getElementById('gallery_'+num);
				
			var figure = document.createElement("figure");
			figure.setAttribute("class", "aui-col-xs-3");
			
			var div = document.createElement("div");
			div.setAttribute("class", "divcss5");
		
			var a = document.createElement("a");
			a.setAttribute("href", server_url);
			var img = document.createElement("img");
			img.src = server_url;
			checkPicurl(img.src);
			var figcaption = document.createElement("figcaption");
		
			a.appendChild(img);
			div.appendChild(a);
			
			figure.appendChild(div);
			figure.appendChild(figcaption)
		    gallery.appendChild(figure);
			

	
							
		}
		function add_button(){
			var gallery = document.getElementById('gallery_2');
			var div = document.createElement("div");
			div.setAttribute("class", "aui-col-xs-3");
			
			var div1 = document.createElement("div");
			div1.setAttribute("class", "divcss5");
			
			var img = document.createElement("img");
			img.src = "img/add.png";
			img.setAttribute("onclick", "pz('1')");
			
			div1.appendChild(img);
			div.appendChild(div1);
			gallery.appendChild(div);
			
	
		}




		function save_info_offline(){
			
			if(office_flag == 1){
				if($("#office_des").val().length < 19){
					top.alertInfo("办公环境描述不得少于20字");
					return;
				}
				if(myArray_offline[1].length == 0){
					top.alertInfo("必须要有办公环境检查图片");
					return;
				}
			}if(beltline_flag == 1){
				if($("#beltline_des").val().length < 19){
					top.alertInfo("生产线环境描述不得少于20字");
					return;
				}
				if(myArray_offline[2].length == 0){
					top.alertInfo("必须要有生产线开工检查图片");
					return;
				}
			}
			if(stock_flag == 1){
				if($("#stock_des").val().length < 19){
					top.alertInfo("库存量描述不得少于20字");
					return;
				}
				if(myArray_offline[3].length == 0){
					top.alertInfo("必须要有库存量检查图片");
					return;
				}
			}
			if(process_flag == 1){
				if($("#process_des").val().length < 19){
					top.alertInfo("项目建设进度描述不得少于20字");
					return;
				}
				if(myArray_offline[4].length == 0){
					top.alertInfo("必须要有项目建设进度检查图片");
					return;
				}
			}
			if(wandp_flag == 1){
				if($("#wandp_des").val().length < 19){
					top.alertInfo("水电检查描述不得少于20字");
					return;
				}
				if(myArray_offline[5].length == 0){
					top.alertInfo("必须要有水电检查图片");
					return;
				}
			}
			if(logistics_flag == 1){
				if($("#logistics_des").val().length < 19){
					top.alertInfo("销售单据检查描述不得少于20字");
					return;
				}
				if(myArray_offline[6].length == 0){
					top.alertInfo("必须要有销售单据检查图片");
					return;
				}
			}

			var data = {
        			fileno : fileno,
        			office_flag:office_flag,
        			beltline_flag:beltline_flag,
        			stock_flag:stock_flag,
        			process_flag:process_flag,
        			wandp_flag:wandp_flag,
        			logistics_flag:logistics_flag,
        			office_des : $("#office_des").val(),
        			office_img : myArray_offline[1].join('|'),
        			beltline_des : $("#beltline_des").val(),
        			beltline_img : myArray_offline[2].join('|'),
        			stock_des : $("#stock_des").val(),
        			stock_img : myArray_offline[3].join('|'),
        			process_des : $("#process_des").val(),
        			process_img : myArray_offline[4].join('|'),
        			wandp_des : $("#wandp_des").val(),
        			wandp_img : myArray_offline[5].join('|'),
        			logistics_des : $("#logistics_des").val(),
        			logistics_img : myArray_offline[6].join('|'),
        			other_des : other_des,//这个怎么组成还要考虑    
        			other_img: myArray_offline[7].join('|'),    			
        			coordinate:top.coordinate,
        			address:top.address_gps,
        			trandate:get_trandate()
        		};
			
			
				top.alertInfo("离线保存成功，请尽快上传");
				top.data.check_step_two = data;
				
				back_history();
				parent.update_button('2');
				return;
			

			
		}
		function upload_info(){
			
			for(var i = 1; i < 8; i++){
				var images = myArray_offline[i].split('|');
				for(var j = 0; j < images.length; j++){
					myArray[i].push(top.uploadPhoto_offline(images[j]));
				}
			}
			top.confirmInfo("图片上传成功，是否保存数据到服务器?", function(msg){
				if(msg == 1){
					$("#upload_button").hide();
					$("#save_button").show();
				}
			});
			
		}
		</script>
    </head>                                
	<body style="overflow:auto;background-color: #f4f4f4;">
	<div class="nextandlast" style="display:none;">
            
                    <div class="left " onClick="close_back();"><div class="back"></div>返回</div>
                    <div id="title" class="center"></div>
                    <div class="right" onclick="is_delete()"></div>
           
        </div>
	<div class="container-fluid" >
		<header class="ui-header ui-header-positive ui-border-b">
            <i class="ui-icon-return" onclick="back_history();top.scroll_auto();"></i><div style="font-size:18px;font-weight:bold;text-align:center;">生产经营情况检查-离线版</div>
        </header>

    	<!-- 办公环境 -->
      	<section class="ui-container" style="background-color: #ffffff;border-top: 1px solid #d0d0d0;margin-top:45px;">
			<section id="form">
		        <div class="demo-item" >
       			 	<div class="demo-block" >
			            <div class="ui-form ui-border-t">
			                <form action="#">
			                    <div class="ui-form-item ui-form-item-switch ui-border-b">
			                        <p style="color:#00a5e0;font-size: 16px;font-weight:bold">
			                          		  办公环境检查
			                        </p>
			                        <label class="ui-switch">
			                            <input type="checkbox" name="office_checkbox"  />
			                        </label>
			                    </div>
			                </form>
			            </div>
			        </div>
       			</div>
		     	<div style="font-size: 15px;text-align: left;" class="office_div">
                       <textarea style="width:90%;color:#5b5b5b;border:0px;background:#ffffff;margin-left: 15px;margin-right: 15px;" rows="4" id="office_des" placeholder="办公环境是否正常进行：文字描述（不得少于20字），并拍照上传，至少拍摄两张照片"></textarea>
                </div>			       			
			</section>
        </section>
        <div class="contain office_div" style="margin: 0 0 0;background-color: #ffffff;border-bottom: 1px solid #d0d0d0;" >
			<ul style="width:100%;">
				<li style="display:inline-block;width:100%;">
        			<!--data-pswp-uid 是每个gallery的id不能重复-->			
					<div class="my-gallery" data-pswp-uid="1" style="width:100%;" id="gallery_1">	
																																										
					</div>
					<div class="aui-col-xs-3"><div class="divcss5"><img src="img/add.png" onclick="pz('1');"/></div></div>																	
				</li>
			</ul>
		</div>
		
		<!--生产线开工检查 -->
      	<section class="ui-container" style="background-color: #ffffff;border-top: 1px solid #d0d0d0;margin-top:10px;" >
			<section id="form">
		        <div class="demo-item" >
       				 
       				 <div class="demo-block" >
			            <div class="ui-form ui-border-t">
			                <form action="#">
			                    <div class="ui-form-item ui-form-item-switch ui-border-b">
			                        <p style="color:#00a5e0;font-size: 16px;font-weight:bold">
			                          		  生产线开工检查
			                        </p>
			                        <label class="ui-switch">
			                            <input type="checkbox" name="line_checkbox"  />
			                        </label>
			                    </div>
			                </form>
			            </div>
			        </div>
       			</div>
		     	<div style="font-size: 15px;text-align: left;" class="line_div">
                       <textarea style="width:90%;color:#5b5b5b;border:1px;background:#ffffff;margin-left: 15px;margin-right: 15px;" rows="4" id="beltline_des" placeholder="生产线开工是否充足：文字描述（不得少于20字），并拍照上传，至少拍摄两张照片"></textarea>
                </div>
			
		  
				
       			
			</section>
        </section>
        <div class="contain line_div" style="margin: 0 0 0;background-color: #ffffff;border-bottom: 1px solid #d0d0d0;" >
			<ul style="width:100%;">
				<li style="display:inline-block;width:100%;">
        			<!--data-pswp-uid 是每个gallery的id不能重复-->			
					<div class="my-gallery" data-pswp-uid="2" style="width:100%;" id="gallery_2">	
																																										
					</div>
					<div class="aui-col-xs-3" ><div class="divcss5"><img src="img/add.png" onclick="pz('2');"/></div></div>																	
				</li>
			</ul>
		</div>
		
		<!--库存量检查-->
      	<section class="ui-container" style="background-color: #ffffff;border-top: 1px solid #d0d0d0;margin-top:10px;">
			<section id="form">
		        <div class="demo-item" >
       				 <div class="demo-block" >
			            <div class="ui-form ui-border-t">
			                <form action="#">
			                    <div class="ui-form-item ui-form-item-switch ui-border-b">
			                        <p style="color:#00a5e0;font-size: 16px;font-weight:bold">
			                          		  库存量检查
			                        </p>
			                        <label class="ui-switch">
			                            <input type="checkbox" name="stock_checkbox"/>
			                        </label>
			                    </div>
			                </form>
			            </div>
			        </div>
       			</div>
		     	<div style="font-size: 15px;text-align: left;" class="stock_div">
                       <textarea style="width:90%;color:#5b5b5b;border:1px;background:#ffffff;margin-left: 15px;margin-right: 15px;" rows="4" id="stock_des" placeholder="库存量情况：文字描述（不得少于20字），拍照上传"></textarea>
                </div>
			
		  
			
       			
			</section>
        </section>
        <div class="contain stock_div" style="margin: 0 0 0;background-color: #ffffff;border-bottom: 1px solid #d0d0d0;">
			<ul style="width:100%;">
				<li style="display:inline-block;width:100%;">
        			<!--data-pswp-uid 是每个gallery的id不能重复-->			
					<div class="my-gallery" data-pswp-uid="3" style="width:100%;" id="gallery_3">	
																																										
					</div>
					<div class="aui-col-xs-3"><div class="divcss5"><img src="img/add.png" onclick="pz('3');"/></div></div>																	
				</li>
			</ul>
		</div>
		
		<!-- 项目建设进度检查 -->
      	<section class="ui-container" style="background-color: #ffffff;border-top: 1px solid #d0d0d0;margin-top:10px;">
			<section id="form">
		        <div class="demo-item" >
       				 
       				 <div class="demo-block" >
			            <div class="ui-form ui-border-t">
			                <form action="#">
			                    <div class="ui-form-item ui-form-item-switch ui-border-b">
			                        <p style="color:#00a5e0;font-size: 16px;font-weight:bold">
			                          		 项目建设进度检查
			                        </p>
			                        <label class="ui-switch">
			                            <input type="checkbox" name="process_checkbox"  />
			                        </label>
			                    </div>
			                </form>
			            </div>
			        </div>
       				 
       			</div>
		     	<div style="font-size: 15px;text-align: left;" class="process_div">
                       <textarea style="width:90%;color:#5b5b5b;border:1px;background:#ffffff;margin-left: 15px;margin-right: 15px;" rows="4" id="process_des" placeholder="项目建设进度：文字描述（不得少于20字），并拍照上传，至少拍摄两张照片"></textarea>
                </div>
			
		  
			
       			
			</section>
        </section>
        <div class="contain process_div" style="margin: 0 0 0;background-color: #ffffff;border-bottom: 1px solid #d0d0d0;">
			<ul style="width:100%;">
				<li style="display:inline-block;width:100%;">
        			<!--data-pswp-uid 是每个gallery的id不能重复-->			
					<div class="my-gallery" data-pswp-uid="4" style="width:100%;" id="gallery_4">	
																																										
					</div>
					<div class="aui-col-xs-3"><div class="divcss5"><img src="img/add.png" onclick="pz('4');"/></div></div>																	
				</li>
			</ul>
		</div>
		<!-- 水电检查检查 -->
      	<section class="ui-container" style="background-color: #ffffff;border-top: 1px solid #d0d0d0;margin-top:10px;">
			<section id="form">
		        <div class="demo-item" >
       				 
       				 <div class="demo-block" >
			            <div class="ui-form ui-border-t">
			                <form action="#">
			                    <div class="ui-form-item ui-form-item-switch ui-border-b">
			                        <p style="color:#00a5e0;font-size: 16px;font-weight:bold">
			                          		水电检查
			                        </p>
			                        <label class="ui-switch">
			                            <input type="checkbox" name="wandp_checkbox"/>
			                        </label>
			                    </div>
			                </form>
			            </div>
			        </div>
       				 
       			</div>
		     	<div style="font-size: 15px;text-align: left;" class="wandp_div">
                       <textarea style="width:90%;color:#5b5b5b;border:1px;background:#ffffff;margin-left: 15px;margin-right: 15px;" rows="4" id="wandp_des" placeholder="水电检查：文字描述（不得少于20字），并拍照上传，至少拍摄两张照片"></textarea>
                </div>
			
		  
			
       			
			</section>
        </section>
        <div class="contain wandp_div" style="margin: 0 0 0;background-color: #ffffff;border-bottom: 1px solid #d0d0d0;">
			<ul style="width:100%;">
				<li style="display:inline-block;width:100%;">
        			<!--data-pswp-uid 是每个gallery的id不能重复-->			
					<div class="my-gallery" data-pswp-uid="5" style="width:100%;" id="gallery_5">	
																																										
					</div>
					<div class="aui-col-xs-3"><div class="divcss5"><img src="img/add.png" onclick="pz('5');"/></div></div>																	
				</li>
			</ul>
		</div>
		
		<!-- 销售单据检查 -->
      	<section class="ui-container" style="background-color: #ffffff;border-top: 1px solid #d0d0d0;margin-top:10px;">
			<section id="form">
		        <div class="demo-item" >
       				 
       				 <div class="demo-block" >
			            <div class="ui-form ui-border-t">
			                <form action="#">
			                    <div class="ui-form-item ui-form-item-switch ui-border-b">
			                        <p style="color:#00a5e0;font-size: 16px;font-weight:bold">
			                          		 销售单据检查
			                        </p>
			                        <label class="ui-switch">
			                            <input type="checkbox" name="logistics_checkbox"  />
			                        </label>
			                    </div>
			                </form>
			            </div>
			        </div>
       				 
       			</div>
		     	<div style="font-size: 15px;text-align: left;" class="logistics_div">
                       <textarea style="width:90%;color:#5b5b5b;border:1px;background:#ffffff;margin-left: 15px;margin-right: 15px;" rows="4" id="logistics_des" placeholder="项目建设进度：文字描述（不得少于20字），并拍照上传，至少拍摄两张照片"></textarea>
                </div>
			
		  
			
       			
			</section>
        </section>
        <div class="contain logistics_div" style="margin: 0 0 0;background-color: #ffffff;border-bottom: 1px solid #d0d0d0;">
			<ul style="width:100%;">
				<li style="display:inline-block;width:100%;">
        			<!--data-pswp-uid 是每个gallery的id不能重复-->			
					<div class="my-gallery" data-pswp-uid="6" style="width:100%;" id="gallery_6">	
																																										
					</div>
					<div class="aui-col-xs-3"><div class="divcss5"><img src="img/add.png" onclick="pz('6');"/></div></div>																	
				</li>
			</ul>
		</div>
		<!--其他检查-->
      	<section class="ui-container" style="background-color: #ffffff;border-top: 1px solid #d0d0d0;border-bottom: 1px solid #d0d0d0;margin-top:10px;">
			<section id="form">
		        <div class="demo-item" >
       				 <div class="demo-desc" style="padding-left:15px;font-size:18px;">其他检查</div>
       			</div>		     		
			</section>
        </section>
        <div class="demo-item">
	        
	        <div class="demo-block">
	            <div class="ui-form ui-border-t">	               
	                <ul class="ui-list ui-list-text ui-list-checkbox ui-border-b ui-row">

	                    <li class=" aui-col-xs-5" style="border-top: 0px solid #d0d0d0;">
	                        <label class="ui-checkbox">
	                            <input type="checkbox" id="box_1" name="other_checkbox"/>
	                        </label>
	                        <p>出入库记录</p>
	                    </li>
	                    <li class=" aui-col-xs-5" style="border-top: 0px solid #d0d0d0;">
	                        <label class="ui-checkbox" style="border-top: 0px solid #d0d0d0;">
	                            <input type="checkbox"  id="box_2" name="other_checkbox"/>
	                        </label>
	                        <p>车位</p>
	                    </li>

	                    
	                    <li class=" aui-col-xs-5" style="border-top: 0px solid #d0d0d0;">
	                        <label class="ui-checkbox">
	                            <input type="checkbox"  id="box_3" name="other_checkbox"/>
	                        </label>
	                        <p>车库</p>
	                    </li>
	                    <li class=" aui-col-xs-5" style="border-top: 0px solid #d0d0d0;">
	                        <label class="ui-checkbox">
	                            <input type="checkbox" id="box_4" name="other_checkbox"/>
	                        </label>
	                        <p>人口出入情况</p>
	                    </li>	                    
	                    <li class=" aui-col-xs-5" style="border-top: 0px solid #d0d0d0;">
	                        <label class="ui-checkbox">
	                            <input type="checkbox"  id="box_5" name="other_checkbox"/>
	                        </label>
	                        <p>上下班流量</p>
	                    </li>	                    
	                    <li class="aui-col-xs-5" >
	                        <label class="ui-checkbox">
	                            <input type="checkbox"  id="box_6" name="other_checkbox"/>
	                        </label>
	                        <p>其他</p>
	                    </li>
	                </ul>
	            </div>
	            
	        </div>
	    </div>
	    <section class="ui-container" style="background-color: #ffffff;">
			<section id="form">
				<div style="font-size: 15px;text-align: left;" class="other_div">
                       <textarea style="width:90%;color:#5b5b5b;border:1px;background:#ffffff;margin-left: 15px;margin-right: 15px;" rows="2" id="other_des" ></textarea>
                </div>
			    <div class="demo-item" >
						 <div class="demo-desc" style="text-align:center;font-size:18px;">请依次上传上述所选图片</div>       				 
				</div>
			</section>
		</section>
        <div class="contain" style="margin: 0 0 0;background-color: #ffffff;border-bottom: 1px solid #d0d0d0;">
			<ul style="width:100%;">
				<li style="display:inline-block;width:100%;">
        			<!--data-pswp-uid 是每个gallery的id不能重复-->			
					<div class="my-gallery" data-pswp-uid="7" style="width:100%;" id="gallery_7">	
																																										
					</div>
					<div class="aui-col-xs-3"><div class="divcss5"><img src="img/add.png" onclick="pz('7');"/></div></div>																	
				</li>
			</ul>
		</div>
		
      	   <section class="ui-container" >
			<section id="form">
				<div class="demo-item" >			       
			        <div class="demo-block"> 
			            <div class="ui-btn-wrap">
			 
			                <button class="ui-btn-lg ui-btn-primary" id="save_offline_button" style="margin-top:20px;" onclick="save_info_offline();">
			                  	 离线保存
			                </button>
			            </div>
			
			        </div>
			    </div>
			   </section>
			  </section>  
		
	
	<div class='div_back' style="display:none;">
		<div class="div_bottom">		
			<p style="text-align:center">是否删除该图片？</p>	
			<ul>
				<li onclick="delete_img()">删除</li>
				<li onclick="button_hide();" style="margin-top:10px;" >取消</li>
			</ul>
		</div>
    </div>
	<!-- Root element of PhotoSwipe. Must have class pswp. -->
	<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
	
	    <!-- Background of PhotoSwipe. 
	         It's a separate element as animating opacity is faster than rgba(). -->
	    <div class="pswp__bg"></div>
	
	    <!-- Slides wrapper with overflow:hidden. -->
	    <div class="pswp__scroll-wrap">
	
	        <!-- Container that holds slides. 
	            PhotoSwipe keeps only 3 of them in the DOM to save memory.
	            Don't modify these 3 pswp__item elements, data is added later on. -->
	        <div class="pswp__container">
	            <div class="pswp__item"></div>
	            <div class="pswp__item"></div>
	            <div class="pswp__item"></div>
	        </div>
	
	        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
	        <div class="pswp__ui pswp__ui--hidden">
	
	            <div class="pswp__top-bar" style="display:none">
	
	                <!--  Controls are self-explanatory. Order can be changed. -->
	
	                <div class="pswp__counter"></div>
	
	                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
	<!-- 
	                <button class="pswp__button pswp__button--share" title="Share"></button>
	 -->
	                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
	
	                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
	
	                <!-- element will get class pswp__preloader--active when preloader is running -->
	                <div class="pswp__preloader">
	                    <div class="pswp__preloader__icn">
	                      <div class="pswp__preloader__cut">
	                        <div class="pswp__preloader__donut"></div>
	                      </div>
	                    </div>
	                </div>
	            </div>
	
	            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
	                <div class="pswp__share-tooltip"></div> 
	            </div>
	
	            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
	            </button>
	
	            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
	            </button>
	
	            <div class="pswp__caption">
	                <div class="pswp__caption__center"></div>
	            </div>
	
	        </div>
	
	    </div>

	</div>
	</div>
	</body>
	<script src="js/jquery.min.js"></script>
<script src="js/photoswipe.js"></script>
<script src="js/photoswipe-ui-default.min.js"></script>
<script type="text/javascript">

var gallery_pswp;
var my_id;
var items_list;
function close_back(){
	console.log("click close");
	gallery_pswp.close();
}
function button_hide(){
	$(".div_back").hide();
}
function is_delete(){
	
	$(".div_back").show();
}
function delete_img(){
	$(".div_back").hide();
	console.log("delete index=:"+gallery_pswp.getCurrentIndex());
	var num = gallery_pswp.getCurrentIndex();
	
	if(num == (myArray[my_id].length - 1)){
		myArray[my_id].splice(num, 1);
		var gallery = document.getElementById('gallery_'+my_id);
		//var list = document.getElementsByTagName('figure');
		var list = gallery.getElementsByTagName('figure');
		gallery.removeChild(list[num]);
		close_back();
		return;
	}else{
		console.log("before delete:"+myArray[my_id]);
		myArray[my_id].splice(num, 1);
		console.log("after delete:"+myArray[my_id]);
		var gallery = document.getElementById('gallery_'+my_id);
		var list = gallery.getElementsByTagName('figure');
		gallery.removeChild(list[num]);
		items_list.splice(num, 1);
		gallery_pswp.invalidateCurrItems();
		// updates the content of slides
		gallery_pswp.updateSize(true);
	}
	
	
}



var initPhotoSwipeFromDOM = function(gallerySelector) {

// 解析来自DOM元素幻灯片数据（URL，标题，大小...）
// (children of gallerySelector)
var parseThumbnailElements = function(el) {
    var thumbElements = el.childNodes,
        numNodes = thumbElements.length,
        items = [],
        figureEl,
        linkEl,
        size,
        item,
		divEl;

    for(var i = 0; i < numNodes; i++) {

        figureEl = thumbElements[i]; // <figure> element

        // 仅包括元素节点
        if(figureEl.nodeType !== 1) {
            continue;
        }
		divEl = figureEl.children[0];
        linkEl = divEl.children[0]; // <a> element
        
       var size = localStorage.getItem(linkEl.getAttribute('href'));
					var width = size.split(',')[0];
					var height = size.split(',')[1];
            item = {
	                  src: linkEl.getAttribute('href'),
	                  w: parseInt(width, 10),
	                  h: parseInt(height, 10)
	              };
       /*
	    var flag = localStorage.getItem("list_flag");
	    if(flag == 0){
	    	 //modify by lwj 20170216
            var ImgObj=new Image();
		    ImgObj.src= linkEl.getAttribute('href');
		    
	    	item = {
	                src: linkEl.getAttribute('href'),
	                w: parseInt(ImgObj.width, 10),
	                h: parseInt(ImgObj.height, 10)
	            };
	    }else{
	    	  item = {
	                  src: linkEl.getAttribute('href'),
	                  w: parseInt(768, 10),
	                  h: parseInt(1024, 10)
	              };
	    }
	    */
	 // 创建幻灯片对象
        
	 /*
        size = linkEl.getAttribute('data-size').split('x');

        // 创建幻灯片对象
        item = {
            src: linkEl.getAttribute('href'),
            w: parseInt(size[0], 10),
            h: parseInt(size[1], 10)
        };

*/

        if(figureEl.children.length > 1) {
            // <figcaption> content
            item.title = figureEl.children[1].innerHTML; 
        }

        if(linkEl.children.length > 0) {
            // <img> 缩略图节点, 检索缩略图网址
            item.msrc = linkEl.children[0].getAttribute('src');
        } 

        item.el = figureEl; // 保存链接元素 for getThumbBoundsFn
        items.push(item);
    }

    return items;
};

// 查找最近的父节点
var closest = function closest(el, fn) {
	
    return el && ( fn(el) ? el : closest(el.parentNode, fn) );
};

// 当用户点击缩略图触发
var onThumbnailsClick = function(e) {
    e = e || window.event;
    e.preventDefault ? e.preventDefault() : e.returnValue = false;

    var eTarget = e.target || e.srcElement;

    // find root element of slide
    var clickedListItem = closest(eTarget, function(el) {
        return (el.tagName && el.tagName.toUpperCase() === 'FIGURE');
    });

    if(!clickedListItem) {
        return;
    }

    // find index of clicked item by looping through all child nodes
    // alternatively, you may define index via data- attribute
    var clickedGallery = clickedListItem.parentNode,
        childNodes = clickedListItem.parentNode.childNodes,
        numChildNodes = childNodes.length,
        nodeIndex = 0,
        index;

    for (var i = 0; i < numChildNodes; i++) {
        if(childNodes[i].nodeType !== 1) { 
            continue; 
        }

        if(childNodes[i] === clickedListItem) {
            index = nodeIndex;
            break;
        }
        nodeIndex++;
    }



    if(index >= 0) {
        // open PhotoSwipe if valid index found
        openPhotoSwipe( index, clickedGallery );
    }
    return false;
};

// parse picture index and gallery index from URL (#&pid=1&gid=2)
var photoswipeParseHash = function() {
    var hash = window.location.hash.substring(1),
    params = {};

    if(hash.length < 5) {
        return params;
    }

    var vars = hash.split('&');
    for (var i = 0; i < vars.length; i++) {
        if(!vars[i]) {
            continue;
        }
        var pair = vars[i].split('=');  
        if(pair.length < 2) {
            continue;
        }           
        params[pair[0]] = pair[1];
    }

    if(params.gid) {
        params.gid = parseInt(params.gid, 10);
    }

    return params;
};

var openPhotoSwipe = function(index, galleryElement, disableAnimation, fromURL) {
	
	localStorage.setItem("open_flag", '1');

    var pswpElement = document.querySelectorAll('.pswp')[0],
        options;
     top.writelog(galleryElement.getAttribute('data-pswp-uid'));   
	my_id = galleryElement.getAttribute('data-pswp-uid');
    items_list = parseThumbnailElements(galleryElement);

    // 这里可以定义参数
    options = {
    		
      barsSize: { 
        top: 100,
        bottom: 100
      }, 
	   fullscreenEl : false,
		shareButtons: [
		{id:'wechat', label:'分享微信', url:'#'},
		{id:'weibo', label:'新浪微博', url:'#'},
		{id:'download', label:'保存图片', url:'{{raw_image_url}}', download:true}
		],
	
        // define gallery index (for URL)
        galleryUID: galleryElement.getAttribute('data-pswp-uid'),

        getThumbBoundsFn: function(index) {
            // See Options -> getThumbBoundsFn section of documentation for more info
            var thumbnail = items_list[index].el.getElementsByTagName('img')[0], // find thumbnail
                pageYScroll = window.pageYOffset || document.documentElement.scrollTop,
                rect = thumbnail.getBoundingClientRect(); 

            return {x:rect.left, y:rect.top + pageYScroll, w:rect.width};
        }

    };

    // PhotoSwipe opened from URL
    if(fromURL) {
        if(options.galleryPIDs) {
            // parse real index when custom PIDs are used 
            for(var j = 0; j < items_list.length; j++) {
                if(items_list[j].pid == index) {
                    options.index = j;
                    break;
                }
            }
        } else {
            // in URL indexes start from 1
            options.index = parseInt(index, 10) - 1;
        }
    } else {
        options.index = parseInt(index, 10);
    }

    // exit if index not found
    if( isNaN(options.index) ) {
        return;
    }

    if(disableAnimation) {
        options.showAnimationDuration = 0;
    }

    // Pass data to PhotoSwipe and initialize it
    gallery_pswp = new PhotoSwipe( pswpElement, PhotoSwipeUI_Default, items_list, options);
    gallery_pswp.init();
    $(".nextandlast").show();
    gallery_pswp.listen('close', function() {
    	$(".nextandlast").hide();
		console.log("close"+gallery_pswp.getCurrentIndex());  
		localStorage.setItem("open_flag", '0');
	});
    
    var count = gallery_pswp.getCurrentIndex();
	count++;
	$("#title").html(count+'/'+items_list.length);

	gallery_pswp.listen('afterChange', function() {
		console.log(gallery_pswp.getCurrentIndex());  
		var count = gallery_pswp.getCurrentIndex();
		count++;
		$("#title").html(count+'/'+items_list.length);
	});
	gallery_pswp.listen('gettingData', function(index, item) {

	    /* Set image source & size based on real viewport width
	    if( useLargeImages ) {
	        item.src = item.originalImage.src;
	        item.w = item.originalImage.w;
	        item.h = item.originalImage.h;
	    } else {
	        item.src = item.mediumImage.src;
	        item.w = item.mediumImage.w;
	        item.h = item.mediumImage.h;
	    }
*/
	
	    // It doesn't really matter what will you do here, 
	    // as long as item.src, item.w and item.h have valid values.
	    // 
	    // Just avoid http requests in this listener, as it fires quite often

	});
};

// loop through all gallery elements and bind events
var galleryElements = document.querySelectorAll( gallerySelector );

for(var i = 0, l = galleryElements.length; i < l; i++) {
    galleryElements[i].setAttribute('data-pswp-uid', i+1);
    galleryElements[i].onclick = onThumbnailsClick;
}

// Parse URL and open gallery if it contains #&pid=3&gid=1
var hashData = photoswipeParseHash();
if(hashData.pid && hashData.gid) {
    openPhotoSwipe( hashData.pid ,  galleryElements[ hashData.gid - 1 ], true, true );
}
};

// execute above function
initPhotoSwipeFromDOM('.my-gallery');


$(".my-gallery>figure>div").each(function(){
	$(this).height($(this).width());
});

function more(obj,id) {
		if ($('#txt'+id).is(":hidden")) {
			$('#p'+id).hide();
	 		$('#txt'+id).show();
	 		obj.innerHTML='收起';
		} else {
			$('#p'+id).show();
	 		$('#txt'+id).hide();
	 		obj.innerHTML='全文';
		}
	}

</script>
</html>
