<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title></title>
<link href="js/lib/bootstrap3.0/bootstrap.css" rel="stylesheet">
<link href="css/lib/zzlcss/menu11.css" rel="stylesheet">
<link rel="stylesheet" href="css/common.css">
<link rel="stylesheet" type="text/css" href="css/aui/aui.css" />
<link rel="stylesheet" href="hello-mui/css/mui.min.css">

<link rel="stylesheet" href="css/frozen.css">
<link rel="stylesheet" href="css/demo.css">
<link rel="stylesheet" type="text/css" href="hello-mui/css/app.css" />
<script src="hello-mui/js/mui.min.js"></script>
                                   
<script type="text/javascript" src="js/lib/jQuery/jquery-2.0.0.min.js"></script>
<script type="text/javascript" src="js/lib/bootstrap3.0/bootstrap.min.js"></script>
<script type="text/javascript" src="js/lib/zzljs/menu11_com.js"></script>
<script src="js/index.js" type="text/javascript" charset="utf-8"></script>
<style>
    html, body {
        position: relative;
        height: 100%;
    }
body {
    background: #fff;
    font-family: Helvetica Neue, Helvetica, Arial, sans-serif;
    font-size: 14px;
    color:#000;
    margin: 0;
    padding: 0;
}
.edit_info{}
.edit_div{
    height:30px;
    line-height:30px;
    padding-left:40px;
}
figcaption{
    text-align:center;
    font-size:14px;
    display:none;
}
p {
    text-indent: 22px;
}
.des {
    margin: .5em 0;
}
.des>li {
    font-size: 14px;
    color: #8f8f94;
}
</style>
<script>
      
      var fileno;
      var file_path;
      var myArray=[];
      var label_list=["保证担保",
                      "抵、质押、公证",
                      "业务合作协议",
                      "其他非标准核保"];
      var items_0=[];
      var items_1=[];
      var items_2=[];
      var items_3=[];
      
      $(function() {
        
        var thisURL = document.URL;
        localStorage.setItem("thisURL", thisURL);
        var getenv = thisURL.split('?')[1];
        localStorage.setItem("list_flag", '1');
        fileno = getenv.split('=')[1];
     
        top.newfileno = 1;
        top.edit_flag = 1;
             
        var data = {
        fileno:fileno
        
        };
        
        Http_ajax(done_check_info, "app/6011", data);
        $("input").attr("readonly", "readonly");
       
        mui.init({
                 swipeBack:true //启用右滑关闭功能
                 });
        mui('.mui-scroll-wrapper').scroll({
                                          deceleration: 0.0005 //flick 减速系数，系数越大，滚动速度越慢，滚动距离越小，默认值0.0006
                                          });

        mui(document.body).on('tap', '.mui-action-back ', function(e) {
			this.click();
			return false;
		});
        mui('.mui-input-group').on('change', 'input', function() {
		//	var value = this.checked?"true":"false";
		//	this.previousElementSibling.innerText = "checked："+value;
			var num = this.value;
			if( this.checked ){
				myArray[num] = 1;
				$("#li_"+num).attr("style", "display:black");
			//	this.previousElementSibling.innerHTML = label_list[this.value] + "<span style='right:60px;color:#3F813F;float:right;'>已选</span>";
				
			}else{
				myArray[num] = 0;
				$("#li_"+num).attr("style", "display:none");
			//	this.previousElementSibling.innerHTML = label_list[this.value];
			
			}
			top.writelog("myArray="+myArray);
			localStorage.setItem("hb_type", myArray.join('-'));

});
        document.getElementById("promptBtn").addEventListener('tap', function(e) {
             //	e.detail.gesture.preventDefault(); //修复iOS 8.x平台存在的bug，使用plus.nativeUI.prompt会造成输入法闪一下又没了
             var btnArray = ['取消', '确定'];
             mui.prompt('请录入该次核保结论，确认后该笔记录将不可再修改', '结论不得少于20字', '核保确认', btnArray, function(e) {
                        if (e.index == 1) {
                        //	info.innerText = '谢谢你的评语：' + e.value;
                        if(e.value.length < 20){
                        mui.toast("结论不得少于20字");
                        this.click();
                        }else{
                        var data = {
                        fileno:localStorage.getItem("fileno"),
                        note:e.value
                        };
                        Http_ajax(function(msg){
                                  top.writelog("6023="+msg);
                                  top.stop_process();
                                  
                                  back_history();
                                  }, "app/6023", data);
                        }
                        } else {
                        
                        }
                        });
             
             });
        
  });
        

  function done_check_info(msg){
      
      top.stop_process();
top.writelog("6011 hb:"+msg);
      var json=eval("("+msg+")");
      


      
      var check_jour_hb = json.data.check_jour_hb;
      var check_jour = json.data.check_jour;
      
      $("#customer").html(check_jour.customer);//客户姓名
      $("#group_code").html(check_jour.group_code);//组织机构代码
      
      localStorage.setItem("customer",check_jour.customer);
      localStorage.setItem("group_code", check_jour.group_code);
      localStorage.setItem("fileno", check_jour.fileno);
      file_path = check_jour.group_code;
      $("#address_gps").html(check_jour.address);//GPS地址
      if(check_jour.is_finish == '1'){ //已经确认的流水不可再编辑
          $(".edit_info").hide();
          $("input[type='checkbox']").attr("disabled", "disabled");
          
          
          $("#check_is_btn").hide();
          $("#check_note_div").show();
          $("#check_note").html(check_jour.note);
          $("#trandate_end").html("<font color='#8e8e8e'>"+check_jour.trandate_end+"</font>");
          $(".edit_div p").html("本次检查没有检查该板块");
      }
      
      var type = check_jour_hb.type;
      var myArray = type.split('-');
      
      for(var i = 0; i < myArray.length; i++){
      	if(myArray[i] == '0'){
      		$("#step_"+i).hide();
      	}else{
      		$("#step_"+i).show();
      		switch(i){
      			case 0:
       			add_pic(check_jour_hb.imgurl_zero, '0', "保证担保");
       			localStorage.setItem("hb_0_"+fileno, check_jour_hb.imgurl_zero);	                                       			
       			$("#date_0").html(check_jour_hb.trandate_zero);	                                        		
       			$("input[value='0']").prop("checked",true);
       			break;
      			case 1:
       			add_pic(check_jour_hb.imgurl_one, '1', "抵、质押、公证");
       			localStorage.setItem("hb_1_"+fileno, check_jour_hb.imgurl_one);
       			$("#date_1").html(check_jour_hb.trandate_one);
       			$("input[value='1']").prop("checked",true);
       			break;
      			case 2:
       			add_pic(check_jour_hb.imgurl_two, '2', "业务合作协议");
       			localStorage.setItem("hb_2_"+fileno, check_jour_hb.imgurl_two);
       			$("#date_2").html(check_jour_hb.trandate_two);
       			$("input[value='2']").prop("checked",true);
       			break;
      			case 3:
       			add_pic(check_jour_hb.imgurl_three, '3', "其他非标准核保");
       			localStorage.setItem("hb_3_"+fileno, check_jour_hb.imgurl_three);
       			$("#date_3").html(check_jour_hb.trandate_three);
       			$("input[value='3']").prop("checked",true);
       			break;
       		default:
       			break
      		}
      	}
      }
     
      
      

  }
  
  function add_pic(img_url, num, title){
  	
  	top.writelog("add_pic:img_url="+img_url+";num="+num+";title="+title);
  	
      var gallery = document.getElementById('gallery_'+num);
      gallery.innerHTML ='';

      if(!img_url || (img_url && img_url.length < 10)) //没有图片名称会小于10
      {
          var figure = document.createElement("figure");
          figure.setAttribute("class", "aui-col-xs-4");
          
          var div = document.createElement("div");
          div.setAttribute("class", "divcss4");
          
          
          var img = document.createElement("img");
          img.src = "img/Nomore.png";
          
          var figcaption = document.createElement("figcaption");
          
          
          div.appendChild(img);
          
          figure.appendChild(div);
          figure.appendChild(figcaption)
          gallery.appendChild(figure);
          
      }else{
          var images = img_url.split('|');
          
          
          var count = localStorage.getItem("count_"+num);
          for(var i = 0; i < images.length; i++){
              
              var figure = document.createElement("figure");
              figure.setAttribute("class", "aui-col-xs-4");
              
              var div = document.createElement("div");
              div.setAttribute("class", "divcss4");
              
              
              var img = document.createElement("img");
              img.setAttribute("onclick", "show_photo('"+count+"','"+num+"')");
              img.src = top.imgpath+file_path+"/" + images[i];
              checkPicurl(img.src);
             
              top.writelog("img.src="+top.imgpath+file_path+"/" + images[i]);
              var figcaption = document.createElement("figcaption");
              figcaption.innerHTML = title;
              
              div.appendChild(img);
              
              figure.appendChild(div);
              figure.appendChild(figcaption)
              gallery.appendChild(figure);
              
              count++;

           var item = {
               src: img.src,
               w: parseInt(768, 10),
               h: parseInt(1024, 10)
           };
           item.title = title;
           if( num == '0'){
               items_0.push(item);
           }else if(num == '1'){
               items_1.push(item);
           }else if(num == '2'){
               items_2.push(item);
           } else if(num == '3'){
               items_3.push(item);
           }

         }
     
      }
      
      top.writelog("gallery_"+num+"="+$("#gallery_"+num).html());
      
  }

  function edit_info(step){
      
      switch(step){
          case '0':
          showNewFrame('check_hb_0.html', 'smask');
          break;
          case '1':
          showNewFrame('check_hb_1.html', 'smask');
          break;
          case '2':
          showNewFrame('check_hb_2.html', 'smask');
          break;
          case '3':
          showNewFrame('check_hb_3.html', 'smask');
          break;

          default:
          break;
          
      }				
  }
  
  function check_is_over(){
      top.confirmInfo("确认后该笔记录将不可再修改，是否确认？", function(msg){
                      if(msg == 1){//确认
                      var data = {
                      fileno:localStorage.getItem("fileno"),
                      
                      };		
                      Http_ajax(function(msg){
                                
                                top.stop_process();
                                
                                back_history();
                                }, "app/6023", data);
                      }
                      })
  }
  
  
  function show_photo(index,num){
  	
  	if(num == 0){
  		top.items_curr = items_0;
  	}else if(num == 1){
  		top.items_curr = items_1;
  	}else if(num == 2){
  		top.items_curr = items_2;
  	}else if(num == 3){
  		top.items_curr = items_3;
  	}
  	

 	 	showNewFrame('showimage_query.html?index='+index+'&num='+num, 'smask');
  }
  
  function edit_type(){
  	$("input[type=checkbox]").attr("disable", "");
  }
  
</script>
</head>

    <body>
        <header class="mui-bar mui-bar-nav head_color">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" onclick="back_history();" ></a>
			<h1 class="mui-title">核保检查明细</h1>
		</header>
        
        <div class="container-fluid">
            <div class="mui-content mui-scroll-wrapper" >   
                <div class="mui-scroll">
                    <section id="list" class="top_head">
                        <div class="demo-item">
                            <div class="demo-block">       
                                <div class="ui-form ui-border-t">
                                    <div class="ui-form-item ui-form-item-l ui-border-b">
                                        <label class="ui-border-r">
                                            客户名称
                                        </label>
                                        <p class="ui-txt-info" style="padding-left: 115px;font-size:14px;" id="customer">联动查询结果</p>	
                                        
                                    </div>
                                    <div class="ui-form-item ui-form-item-l ui-border-b">
                                        <label class="ui-border-r">
                                            机构代码
                                        </label>
                                        <p class="ui-txt-info" style="padding-left: 115px;font-size:14px;" id="group_code">联动查询结果</p>	                      
                                    </div>                
                                    <div class="ui-form-item ui-form-item-l ui-border-b">
                                        <label>
                                            检查地址
                                        </label>
                                        <p class="ui-txt-info" style="padding-left: 115px;font-size:14px;" id="address_gps">联动查询结果</p> 
                                    </div>
                                </div>           
                            </div>
                        </div> 
                    </section>  
					<div class="mui-card">
						<form class="mui-input-group">
							<div class="mui-input-row mui-checkbox">
								<label>保证担保</label>
								<input name="checkbox0" value="0" type="checkbox"  >
							</div>
							<div class="mui-input-row mui-checkbox">
								<label>抵、质押、公证</label>
								<input name="checkbox1" value="1" type="checkbox"  >
							</div>
							<div class="mui-input-row mui-checkbox">
								<label>业务合作协议</label>
								<input name="checkbox2" value="2" type="checkbox" >
							</div>
							<div class="mui-input-row mui-checkbox">
								<label>其他非标准核保</label>
								<input name="checkbox3" value="3" type="checkbox" >
							</div>
						</form>					
					</div>
                    <div class="demo-item" style="background-color: #ffffff">        
                        <div class="demo-block" style="background-color: #ffffff">        
                            
                            <div class="demo-desc" style="border-top:1px solid #d0d0d0;margin-top:10px;">保证担保</div>
                            <div id="step_0" style="display:none;background-color: #ffffff;">
                                <div  id="place_0" style="padding-left:40px;padding-bottom:20px;">                             	
                                    <div class="contain" style="margin: 0 0 0;background-color: #ffffff;">
                                        <ul >
                                            <li style="display:inline-block;width:100%;padding-right:40px;" >
                                                <div class="my-gallery" style="width:100%;padding-left:15px;" data-pswp-uid="0"  id="gallery_0">	                                                   
                                                </div>	                                               
                                            </li>
                                        </ul>
                                    </div>   
                                </div>
                            </div>
                            <div class="edit_div" style="background-color: #ffffff;">
                                <p style="float:left;padding-left:10px;font-size:14px;padding-top:10px;" id="date_0">还未录入</p>
                                <div class="edit_info" style="float:right;padding-right:20px;" onclick="edit_info('0')"><img src="img/edit.png" />
                                </div> 
                            </div>
							<div class="demo-desc" style="border-top:1px solid #d0d0d0;margin-top:10px;">抵、质押、公证</div>
                            <div id="step_1" style="display:none">
                                <div  id="place_1" style="padding-left:40px;padding-bottom:20px;">                             	
                                    <div class="contain" style="margin: 0 0 0;background-color: #ffffff;">
                                        <ul >
                                            <li style="display:inline-block;width:100%;padding-right:40px;" >
                                                <div class="my-gallery" style="width:100%;padding-left:15px;" data-pswp-uid="1"  id="gallery_1">	                                                    
                                                </div>	                                               
                                            </li>
                                        </ul>
                                    </div>   
                                </div>
                            </div>
                            <div class="edit_div">
                                <p style="float:left;padding-left:10px;font-size:14px;padding-top:10px;" id="date_1">还未录入</p>
                                <div class="edit_info" style="float:right;padding-right:20px;" onclick="edit_info('1')"><img src="img/edit.png" />
                                </div> 
                            </div>
                            <div class="demo-desc" style="border-top:1px solid #d0d0d0;margin-top:10px;">业务合作协议</div>
                            <div id="step_2" style="display:none">
                                <div  id="place_2" style="padding-left:40px;padding-bottom:20px;">                             	
                                    <div class="contain" style="margin: 0 0 0;background-color: #ffffff;">
                                        <ul >
                                            <li style="display:inline-block;width:100%;padding-right:40px;" >
                                                <div class="my-gallery" style="width:100%;padding-left:15px;" data-pswp-uid="2"  id="gallery_2">	                                                    
                                                </div>	                                                
                                            </li>
                                        </ul>
                                    </div>   
                                </div>
                            </div>
                            <div class="edit_div">
                                <p style="float:left;padding-left:10px;font-size:14px;padding-top:10px;" id="date_2">还未录入</p>
                                <div class="edit_info" style="float:right;padding-right:20px;" onclick="edit_info('2')"><img src="img/edit.png" />
                                </div> 
                            </div>
                            <div class="demo-desc" style="border-top:1px solid #d0d0d0;margin-top:10px;">其他非标准核保</div>
                            <div id="step_3" style="display:none">
                                <div  id="place_3" style="padding-left:40px;padding-bottom:20px;">                             	
                                    <div class="contain" style="margin: 0 0 0;background-color: #ffffff;">
                                        <ul >
                                            <li style="display:inline-block;width:100%;padding-right:40px;" >
                                                <div class="my-gallery" style="width:100%;padding-left:15px;" data-pswp-uid="3"  id="gallery_3">	
                                                    
                                                </div>	
                                                
                                            </li>
                                        </ul>
                                    </div>   
                                </div>
                            </div>
                            <div class="edit_div">
                                <p style="float:left;padding-left:10px;font-size:14px;padding-top:10px;" id="date_3">还未录入</p>
                                <div class="edit_info" style="float:right;padding-right:20px;" onclick="edit_info('3')"><img src="img/edit.png" />
                                </div> 
                            </div>                                
                            <div class="demo-item edit_info" id="check_is_btn" style="margin-top:30px;border-top: 1px solid #d0d0d0;">
                                <div class="demo-block">
                                    <div class="ui-btn-wrap">
                                        <button class="ui-btn-lg"  id='promptBtn' >
                                            核保确认
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div style="font-size: 15px;text-align: left;margin-top:10px;display:none;border-top:1px solid #d0d0d0;border-bottom:1px solid #d0d0d0;padding:10px;height:300px;" id="check_note_div">
                                <p style="text-align:center;font-size:16px;color:#000">核保检查结论</p>
                                <p  id="trandate_end" style="text-align:right;color:#000"></p>
                                <p  id="check_note" style="color:#000"></p>
                            </div>
                            </div>
                        </div>                       
                    </div>
                </div></div>
            
            
            
            
            </body>
    
</html>
