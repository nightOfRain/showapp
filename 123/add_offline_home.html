
<html>

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title></title>
		<link href="js/lib/bootstrap3.0/bootstrap.css" rel="stylesheet">		
		<link href="css/lib/zzlcss/menu11.css" rel="stylesheet">
		<link rel="stylesheet" href="css/circle_reset.css">
		<link rel="stylesheet" href="hello-mui/css/mui.min.css">
		<link rel="stylesheet" href="hello-mui/css/app.css">
    	<link rel="stylesheet" href="css/circle_style.css" media="screen" type="text/css" />
        
        <link rel="stylesheet" href="css/frozen.css">
        <link rel="stylesheet" href="css/demo.css">
       
        <link rel="stylesheet" type="text/css" href="css/aui/aui.css" />
		
		<script src="hello-mui/js/mui.min.js"></script>
		<script type="text/javascript" src="js/lib/jQuery/jquery-2.0.0.min.js"></script>
		<script type="text/javascript" src="js/lib/bootstrap3.0/bootstrap.min.js"></script>
       
		<script type="text/javascript" src="js/lib/zzljs/menu11_com.js"></script>
		
       
        <script src="js/frozen.js"></script>
        <script type="text/javascript" src="js/nt_zuobiao.js"></script>
        <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=kZ76MkTNOIQ1VnidegnnxbKc"></script>
        <script src="js/index.js" type="text/javascript" charset="utf-8"></script>
         <style>
             html, body {
                 position: relative;
                 height: 100%;
             }
         body {
             background: #fff;
             font-family: Helvetica Neue, Helvetica, Arial, sans-serif;
             font-size: 14px;
             color:#000;
             margin: 0;
             padding: 0;
             overflow:auto;
          
         }
         .button_color{
         color:red;
         	background:3F8E3F;
         	font-weight:bold;
         	
         }
         .rgt_scan {
	width: 24px;
	height: 24px;
	float: right;
	margin-right: 20px;
	margin-top: 12px;
	background-size: 100% 100%;
	background-image: url("img/scan.png");
}
 .rgt_search {
   width: 20px;
   height: 20px;
   float: right;
   margin-right: 16px;
   margin-top: 12px;
   background-size: 100% 100%;
   background-image: url("img/search.png");
 }
         .customer_div{}
         .div_fullscreen{       
    z-index:9998;background-color:rgba(244,244,244,1);width:100%;height:100%;position: fixed;top:0px;
}
.finish{
background: rgba(123, 123, 123, 0.9);
}
.check_back{
background-color:#ffffff;}
 .red_div{
float:right;
top:-4px;
right:40px;
position:absolute;
height:20px;
line-height:20px;
width:20px;
text-align: center;
align-items: center;
justify-content: center;
z-index:10011;
border-radius:30px;
box-shadow: 0 0 3px #222;
background: red;
color: #ffffff;
font-size:13px;

}
 .head_div{
text-align:center;
border-radius: 2px;
font-size:16px;
background:rgba(235,236,237,0.5);
height:35px;
color:#8e8e8e;
line-height:35px;
margin-top:5px;
margin-left:60px;
padding-left:5px;}
        </style>
 		<script>
 		//background:-webkit-gradient(linear,0% 0%, 0% 100%, from(#999999), to(#333333), color-stop(0.5,#336600));
			var thisURL; 
			var step_now = 1;
			var ntzb=new NTzuobiao();//实例化坐标转换类
			var startX, startY, endX, endY;
			var start_flag = 0;
			var offline_flag = 0;
			var myArray = new Array(); 
			var myArray_offline = new Array(); 
			var fileno;
			$(function() {				
		
				thisURL = document.URL; 
				localStorage.setItem("thisURL", thisURL);
				top.map_flag = 0;
				top.offline = 1;
				top.edit_flag = 1;
				top.data={};
				localStorage.setItem("list_flag", '0');
			
		
				
				loading();

				
			
				mui.init({
					swipeBack:true //启用右滑关闭功能
				});
				mui('.mui-scroll-wrapper').scroll({
	                deceleration: 0.0005 //flick 减速系数，系数越大，滚动速度越慢，滚动距离越小，默认值0.0006
	                });
				mui(document.body).on('tap', '.mui-action-back ', function(e) {
					this.click();
                    return false;
				});


				file_begin();
			});  

			


			function file_begin(){

				//做开关
				if(start_flag == 1){
					return;
				}else{
					var data = {
							user_id:localStorage.getItem("user_id"),
							manager_id:top.user_name,
							inst_id:top.inst_name,
							customer:localStorage.getItem("customer"),
							group_code:localStorage.getItem("group_code"),  
							type:'0',
							force:'0',
							coordinate:top.coordinate,
		        			address:top.address_gps,
		        			trandate:get_trandate()
					};
		
					Http_ajax(function(msg){
						
						top.stop_process();
						top.writelog("frist:6003="+msg);
						var json=eval("("+msg+")");
						
						
						
						top.data.trandate = get_trandate();
						top.data.customer = localStorage.getItem("customer");
						top.data.type = '0';
						if(json.data.stat == 0 ){ //新增
							start_flag = 1;
							//window.scrollTo(0,$('#off_top').offset().top);
							top.data.fileno = json.data.fileno;
							localStorage.setItem("fileno", json.data.fileno);
							localStorage.setItem("fileno_offline", json.data.fileno);
							fileno = json.data.fileno;
							return;
						}else{
							var statinfo ='';
							
							if(json.data.stat == 1){ //已有且未完成
								statinfo = '检查未完成';
							}else if(json.data.stat == 2){//已有且完成
								statinfo = '检查已完成';							
							}
							top.confirmInfo_new("今天对该客户已经做过检查，且"+statinfo+"。请选择如下操作", function(msg){
								if(msg == 1){ //继续录入
									top.data.fileno = json.data.fileno;
									localStorage.setItem("fileno", json.data.fileno);
									localStorage.setItem("fileno_offline", json.data.fileno);
									fileno = json.data.fileno;
									var offline_stat = localStorage.getItem("offline_"+fileno);
									if( offline_stat == '1'){ //有本地离线数据未上传
										top.data = localStorage.getItem(fileno+"_data_offline");
										if(top.data.check_jour_one){
											$("#step_1").attr("style","background:rgba(68, 153, 238, 0.9)");
											$("#step_1").html("图片等待上传中...");
										}
										if(top.data.check_jour_two){
											$("#step_2").attr("style","background:rgba(68, 153, 238, 0.9)");
											$("#step_2").html("图片等待上传中...");
										}
										if(top.data.check_jour_three){
											$("#step_3").attr("style","background:rgba(68, 153, 238, 0.9)");
											$("#step_3").html("图片等待上传中...");
										}
										if(top.data.check_jour_four){
											$("#step_4").attr("style","background:rgba(68, 153, 238, 0.9)");
											$("#step_4").html("图片等待上传中...");
										}
										if(top.data.check_jour_five){
											$("#step_5").attr("style","background:rgba(68, 153, 238, 0.9)");
											$("#step_5").html("图片等待上传中...");
										}
										if(top.data.check_jour_six){
											$("#step_6").attr("style","background:rgba(68, 153, 238, 0.9)");
											$("#step_6").html("图片等待上传中...");
										}
									}else{
										top.data.fileno = json.data.fileno;
										fileno = json.data.fileno;
										var data = {
												fileno:fileno											
										};
										Http_ajax(function(msg){
											top.stop_process();
											var json=eval("("+msg+")");
											top.data = json.data;
											var check_jour_one = json.data.check_step_one;
											var check_jour_two = json.data.check_step_two;
											var check_jour_three = json.data.check_step_three;
											var check_jour_four = json.data.check_step_four;
											var check_jour_five = json.data.check_step_five;
											var check_jour_six = json.data.check_step_six;
											if(check_jour_one){
												$("#step_1").attr("style","background:rgba(68, 153, 238, 0.9)");
											}
											if(check_jour_two){
												$("#step_2").attr("style","background:rgba(68, 153, 238, 0.9)");
											}
											if(check_jour_three){
												$("#step_3").attr("style","background:rgba(68, 153, 238, 0.9)");
											}
											if(check_jour_four){
												$("#step_4").attr("style","background:rgba(68, 153, 238, 0.9)");
											}
											if(check_jour_five){
												$("#step_5").attr("style","background:rgba(68, 153, 238, 0.9)");
											}
											if(check_jour_six){
												$("#step_6").attr("style","background:rgba(68, 153, 238, 0.9)");
											}
										}, "app/6011", data);
									}
									
								}else if(msg == 2){//重新录入
									
									var data = {
											user_id:localStorage.getItem("user_id"),
											manager_id:top.user_name,
											inst_id:top.inst_name,
											customer:localStorage.getItem("customer"),
											group_code:localStorage.getItem("group_code"),  
											type:'0',
											force:'1',
											coordinate:top.coordinate,
						        			address:top.address_gps,
						        			trandate:get_trandate()
									};
									Http_ajax(function(msg){
										top.stop_process();
										var json=eval("("+msg+")");
										
										top.data.fileno = json.data.fileno;
										localStorage.setItem("fileno", json.data.fileno);
										localStorage.setItem("fileno_offline", json.data.fileno);
										fileno = json.data.fileno;
										top.writelog("6003:"+msg);
										
									}, "app/6003", data);
								}
							});
							
						}
						
					}, "app/6003", data);
					
				}
				
				
			}
			function update_button(step){		
	
	
				$("#step_"+i+"_img").attr("src", "imgurl");
				$("#step_"+i+"_span").html("图片等待上传中...");

			}
			
			function clear_all(){
				
						//隐藏功能模块
						$("#check_div").hide();		
						$(".check_back").hide();
						$(".customer_div").hide();
					
						$("#notice_info").show();
						//清空流水号
						fileno = '';
						localStorage.setItem("fileno", "");
						step_new = 1;//步骤计数
						
						start_flag = 0;
						top.data={};
						//清理输入项
						$("#customer").html('');
						$("#group_code").html('');
					
						//重置按钮
						for(var i = 1; i < 7; i++){
							$("#step_"+i).attr("style"," background: rgba(255, 255, 255, 0.9)");
				
						}
						
						//初始化事件按钮
						var click_div = document.getElementById('start_btn');
						click_div.classList.remove("selected");
					      $("#start_btn").html("Start");
					      
					      if (!click_div.parentNode.classList.contains("radmenu")) {
					    	  click_div.parentNode.parentNode.parentNode.querySelector("a").classList.add("selected")
					      	//this.click();
					      } else {
					    	  click_div.classList.add("show");
					      }
						scroll_auto();
				
				top.alertInfo("本次检查已保存成功，请在【信息查看】里再次确认并提交检查结论，完成本次检查");
				top.menu_refresh();
			}

			function scroll_auto(){
				

			}
			function check_by_step_two(){
				showNewFrame('office_check.html', 'smask');
			}
			function check_by_step(step){

				switch(step){
					case 1:
						showNewFrame('offline_business_place.html', 'smask');												
						break;
					case 2:	
						showNewFrame('offline_office_check.html', 'smask');
						break;
					case 3:		
						showNewFrame('offline_finance_check.html', 'smask');											
						break;
					case 4:
						showNewFrame('offline_taxes_check.html', 'smask');												
						break;
					case 5:	
						showNewFrame('offline_bank_check.html', 'smask');												
						break;
					case 6:
						showNewFrame('offline_pawn_check.html', 'smask');												
						break;
					default:
						break;
				
				}
			}


	
			function upload_offline(){

    			
    			top.images_offline = '';
				top.confirmInfo("请确认处于网络流畅环境再发起上传，是否确定上传？", function(msg){
					if(msg == 1){

						top.upload_offline(after_upload);
					}
				});
			}
			function isEmpty(obj) {

				if(!obj && obj != 0 && obj != '') {　　　　　　　　　
				  return true;
				}
				
				if(Array.prototype.isPrototypeOf(obj) && obj.length == 0) {
					　　　return true;
				}
				
				if(Object.prototype.isPrototypeOf(obj) && Object.keys(obj).length == 0) { 
					
					　return true; 　　　
				}
				return false; 
			}
			function after_upload(){
				if(top.err_count == 0){
					top.confirmInfo("图片上传成功，是否保存数据到服务器?", function(msg){
						if(msg == 1){
							save_offline();
						}else{
							$("#start_btn").attr("style","background:rgba(68, 153, 238, 0.9)");
							$("#start_btn").html("保存检查数据");
							$("#start_btn").attr("onclick", "save_offline()");
						}
					});
				}else{		
					 $("#start_btn").html("继续上传");
					 $("#start_btn").attr("href","javascript:void(0)");
					 $("#start_btn").attr("onclick","upload_offline(after_upload)");
									
				}
			}

			function save_offline(){
				
				var str = localStorage.getItem(fileno+"_data_offline");
				var data = {
						data:str
				}
				
				Http_ajax(function(msg){
					top.stop_process();
					top.writelog("6027:"+msg);
					var json = eval("("+msg+")");
					if(json.stat == 0){		
						top.alertInfo(json.msg);	
						
						//离线数据保存成功后，清理离线数据
						top.data = '';
						localStorage.removeItem(fileno+"_data_offline"); //离线数据
						localStorage.removeItem("offline_"+fileno); //流水号离线状态
						localStorage.removeItem("fileno_offline");//离线流水号
						clear_all();
						return;
					}else{
						top.alertInfo(json.msg);
					}
					
				}, "app/6027", data);
				
			}
		</script>
    </head>
    
<body>
 	<header class="mui-bar mui-bar-nav head_color">
		<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" onclick="back_history();" ></a>
		<h1 class="mui-title">尽职调查-离线检查</h1>
	</header>
	<div class="mui-content mui-scroll-wrapper" >
    	<div class="mui-scroll" >
            <iframe style="width:100%;border:0;margin-top:25px;" src="map_header.html" mce_src="map_header.html" name="tmp_iframe" id="tmp_iframe"></iframe>
        
        	<section id="cd-timeline" class="cd-container" style="margin-top:-30px;">
					<div class="cd-timeline-block" onclick="check_by_step('1')" id="step_1">
						<div class="cd-timeline-img cd-picture">
							<img src="img/cd-icon-picture.svg" alt="Picture" id="step_1_img">
						</div>
				
						<div class="cd-timeline-content">
							<a class="cd-read-more" target="_blank"></a>
							<h2>客户经营场所检查</h2>																																						
							<span class="cd-date" id="step_1_span">2015-01-06 15:32</span>							
						</div>
					</div>
					<div class="cd-timeline-block pass" onclick="check_by_step('2')" id="step_2">
						<div class="cd-timeline-img cd-picture">
							<img src="img/cd-icon-movie.svg" alt="Movie" id="step_2_img">
						</div>
				
						<div class="cd-timeline-content">
							<a class="cd-read-more" target="_blank"></a>
							<h2>生产经营情况检查</h2>							
							<span class="cd-date" id="step_2_span">2015-01-06</span>							
						</div>
					</div>
					<div class="cd-timeline-block pass" onclick="check_by_step('3')" id="step_3">
						<div class="cd-timeline-img cd-picture">
							<img src="img/cd-icon-movie.svg" alt="Movie" id="step_3_img">
						</div>
				
						<div class="cd-timeline-content">
							<a class="cd-read-more" target="_blank"></a>
							<h2>财务报表信息检查</h2>								
							<span class="cd-date" id="step_3_span">2015-01-06</span>							
						</div>
					</div>
					<div class="cd-timeline-block pass" onclick="check_by_step('4')" id="step_4">
						<div class="cd-timeline-img cd-picture">
							<img src="img/cd-icon-movie.svg" alt="Movie" id="step_4_img">
						</div>
				
						<div class="cd-timeline-content">
							<a class="cd-read-more" target="_blank"></a>
							<h2>纳税申报信息检查</h2>								
							<span class="cd-date" id="step_4_span">2015-01-06</span>							
						</div>
					</div>
					<div class="cd-timeline-block pass" onclick="check_by_step('5')" id="step_5">
						<div class="cd-timeline-img cd-picture">
							<img src="img/cd-icon-movie.svg" alt="Movie" id="step_5_img">
						</div>
				
						<div class="cd-timeline-content">
							<a class="cd-read-more" target="_blank"></a>
							<h2>银行对账信息检查</h2>			
							<span class="cd-date" id="step_5_span">2015-01-06</span>							
						</div>
					</div>
					<div class="cd-timeline-block pass" onclick="check_by_step('6')" id="step_6">
						<div class="cd-timeline-img cd-picture">
							<img src="img/cd-icon-movie.svg" alt="Movie" id="step_6_img">
						</div>
				
						<div class="cd-timeline-content">
							<a class="cd-read-more" target="_blank"></a>
							<h2>抵押物现状检查</h2>	
							<span class="cd-date" id="step_6_span">2015-01-06</span>							
						</div>
					</div>


				</section>
				<div style="margin-top:10px;text-align:center;margin-bottom: 300px;"  onclick="upload_offline();">
					<button type="button" class="mui-btn  mui-btn-primary" style="width:90%">现在上传</button>
				</div>
        </div>
	</div>

       

    </body>
</html>
