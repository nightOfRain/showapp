<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="js/lib/bootstrap3.0/bootstrap.css" rel="stylesheet">		

<link rel="stylesheet" href="hello-mui/css/mui.min.css">
<link rel="stylesheet" href="hello-mui/css/app.css">

<script type="text/javascript" src="js/lib/jQuery/jquery-2.0.0.min.js"></script>
<script type="text/javascript" src="js/lib/bootstrap3.0/bootstrap.min.js"></script> 

<script type="text/javascript" src="js/nt_zuobiao.js"></script>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=kZ76MkTNOIQ1VnidegnnxbKc"></script>

<script src="js/index.js" type="text/javascript" charset="utf-8"></script>
<style>

</style>
<script>
 		//background:-webkit-gradient(linear,0% 0%, 0% 100%, from(#999999), to(#333333), color-stop(0.5,#336600));
			var thisURL; 

			var ntzb=new NTzuobiao();//实例化坐标转换类

	
			$(function() {				
			
				thisURL = document.URL; 
				
				loading();

				

				//页面加载后10秒  检查定位情况
				setTimeout(function(){
					if(top.map_flag == 0){
						 top.alertInfo("未获取到地址信息，若点击确认后依旧无法获取地理位置，请退出后重新打开该页面并检查手机网络【苹果手机请确认定位权限是否打开】");
					//	 window.location.reload();
						 return ;
					}
				},8000);

			});
            
            function move_by_offset(){
                mui('.mui-scroll-wrapper').scroll().reLayout();
                mui('.mui-scroll-wrapper').scroll().scrollToBottom(top.offset_y);
            }
				function loading(){
				
				window.top.getmylocation_r(buildmap);

			
			}
            function buildmap(msg) {
                
            	var parr = msg.split(',');
				top.writelog("parr="+JSON.stringify(parr));
				var point=new BMap.Point(parr[0],parr[1]);
              
                
                var  map = new BMap.Map("maps",{enableMapClick:false});
                
              
                
                map.centerAndZoom(point, 18);
                
                var myPos = new BMap.Marker(point);
                map.addOverlay(myPos);
                
                var myGeo = new BMap.Geocoder();
                myGeo.getLocation(point, function(result){
                                  if (result){
                                  top.address_gps = result.address;
                                  $("#address_gps").html(result.address);
//                                   if(top.map_flag == 0){
                                  
//                                   top.map_flag = 1;
//                                   }
                                  top.add_value_android(null, null, "address_gps", result.address);
                                  
                                  }
                                  });
                                  
            }
			//获取当前位置
			function cxdw(msg){
				var parr = msg.split(',');
				top.writelog("parr="+JSON.stringify(parr));
				var point=new BMap.Point(parr[0],parr[1]);
				
              
 
            
					var myGeo = new BMap.Geocoder();
					myGeo.getLocation(point, function(result){
                                
				    	if (result){
                                      top.writelog("result="+result);
				    		top.address_gps = result.address;
				    		$("#address_gps").html(result.address);
// 					    		if(top.map_flag == 0){
					    			
// 					    			top.map_flag = 1;
// 					    		}
 							top.add_value_android(null, null, "address_gps", result.address);
				    
				    	}      
					});		
			}
			function update_address(address){	
				top.writelog("hha:"+address);
				top.address_gps = address;
				$("#address_gps").html(address);			
			}
		</script>
    </head>
    

		 <div id="map_div">
               <div class="mui-row" style="padding:5px;background-color:#fff;">
                   <div class="mui-col-xs-3" style="border:1px solid #8A8B8F;">
                       <div id="maps" style="width:100%;height:25vw;"></div>
                   </div>
                   <div class="mui-col-xs-9" style="padding-left:10px;padding-top:10px;">
                       <p style="" id="notice_info">点击右上角可小幅调整定位</p>
                       <p style="color:#00a5e0;font-size: 14px">现场检查GPS定位</p>
                       <p style="font-size: 12px" id="address_gps">正在获取当前地址。。。</p>
                   </div>
               </div>
		 </div>
	

</html>
