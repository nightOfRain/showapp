<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title></title>
<link href="js/lib/bootstrap3.0/bootstrap.css" rel="stylesheet">
<link href="css/lib/zzlcss/menu11.css" rel="stylesheet">
<link rel="stylesheet" href="css/common.css">
<link rel="stylesheet" href="hello-mui/css/mui.min.css">

<!--App自定义的css-->
<link rel="stylesheet" type="text/css" href="hello-mui/css/app.css" />
<link href="hello-mui/css/mui.picker.css" rel="stylesheet" />
<link href="hello-mui/css/mui.poppicker.css" rel="stylesheet" />

<script type="text/javascript" src="js/lib/jQuery/jquery-2.0.0.min.js"></script>
<script type="text/javascript" src="js/lib/bootstrap3.0/bootstrap.min.js"></script>

<script type="text/javascript" src="js/lib/zzljs/menu11_com.js"></script>
<script src="js/index.js" type="text/javascript" charset="utf-8"></script>
<style>
html, body {
    position: relative;
    height: 100%;
}
body {
    background: #fff;
    font-family: Helvetica Neue, Helvetica, Arial, sans-serif;
    font-size: 14px;
    color:#000;
    margin: 0;
    padding: 0;
    overflow:auto;
    
}
.div_fullscreen_pg{
    
    z-index:9998;background-color:rgba(2,2,2,0.8);width:100%;height:100%;position: fixed;top:0px;
}

.div_process{
    
    z-index:9999;background-color:#FFFFFF; width:100%;position: fixed; bottom:0;left:0;text-align:left;
    
}
h5.mui-content-padded {
    margin-left: 3px;
    margin-top: 20px !important;
}
h5.mui-content-padded:first-child {
    margin-top: 12px !important;
}
.ui-alert {
    text-align: center;
    padding: 20px 10px;
    font-size: 16px;
}


.head_color{
    background-color: #18b4ed;
}
.mui-input-row input{
    font-size:15px;
   
}
.mui-input-row textarea{
    font-size:15px;
    
}
</style>
<script>
                                    
var thisURL;
var category_value = '0';
var guarant_type_value = '0';
var risk_type_value = '0';
$(function() {

    mui.init({
           swipeBack:true //启用右滑关闭功能
           });
    mui('.mui-scroll-wrapper').scroll({
                                    deceleration: 0.0005 //flick 减速系数，系数越大，滚动速度越慢，滚动距离越小，默认值0.0006
                                    });
    mui(document.body).on('tap', '.mui-action-back', function(e) {
                        this.click();
                        return false;
                        });
    top.edit_flag = 1;
  });
  
//根据证件号码查客户信息
function query_by_no(){
  var qno = $("#group_code").val();
  
  var isCheck=isCardID(qno);
  if(isCheck){
      top.alertInfo(isCheck);
      return;
  }
  var data = {
      group_code:qno,
      user_id:localStorage.getItem("userid"),
      customer_type:'1'
  };
  top.writelog("businesscheck="+JSON.stringify(data));
  
  Http_ajax(function(msg){
            top.writelog("6046="+msg);
            top.stop_process();
            
            var json = eval("("+msg+")");
            
            if(json.data.retcode == '2'){ //已录入过该客户信息
              
                $("#tel_no").val(json.data.customerinfo[0].tel_no);
                $("#customer").val(json.data.customerinfo[0].customer);
                $("#ls_address").val(json.data.customerinfo[0].ls_address);
                $("#risk_type").val(json.data.customerinfo[0].risk_type);
                $("#guarant_type").val(json.data.customerinfo[0].guarant_type);
                $("#guarantor").val(json.data.customerinfo[0].guarantor);
                $("#corporation").val(json.data.customerinfo[0].corporation);
                $("#category").val(json.data.customerinfo[0].category);
                $("#address").val(json.data.customerinfo[0].address);
                if(json.data.customerinfo[0].customer_state == '1'){
                   
                    top.confirmInfo("存量用户信息不可修改，是否开始检查？", function(msg){
                              if(msg == '2'){
                            	  $(".mui-table-view").show();
                              }
                              });
                }else{
                 
                    top.confirmInfo("新增用户，点【确定】开始检查，点【取消】修改用户信息", function(msg){
                        if(msg == '1'){
                        	$(".mui-table-view").show();
                        }
                        });
                }
            }
            
            
            }, "app/6046", data);

}

function add_or_modify(){
    var qno = $("#group_code").val();
    var customer = $("#customer").val();
    
    if(top.isEmpty(qno)){
        top.alertInfo("证件编号不能为空");
        return;
    }
    var isCheck=isCardID(qno);
    if(isCheck){
        top.alertInfo(isCheck);
        return;
    }
    if(top.isEmpty(customer)){
        top.alertInfo("客户姓名不能为空");
        return;
    }
    
    var data = {
        user_id:localStorage.getItem("user_id"),
        group_code:$("#group_code").val(),
        customer:$("#customer").val(),
        tel_no:$("#tel_no").val(),
        ls_address:$("#ls_address").val(),
        risk_type:$("#risk_type").val(),
        guarant_type:$("#guarant_type").val(),
        guarantor:$("#guarantor").val(),
        corporation:$("#corporation").val(),
        category:$("#category").val(),
        address:$("#address").val(),
        customer_type:'1'
    };
    top.writelog("6047 send="+JSON.stringify(data));
    
    Http_ajax(function(msg){
              top.writelog("6047="+msg);
              top.stop_process();
              
              var json = eval("("+msg+")");
              top.writelog("6047 recv:"+msg);
              if(json.stat == '0'){ //保存成功
                  top.confirmInfo("提交成功，是否开始检查？", function(msg){
                                if(msg == '1'){
                                	$(".mui-table-view").show();
                                }
                                });
                  $("input").attr("readonly", "readonly");
                 
              
              }else{
              top.alertInfo("提交失败:"+json.data.retinfo);
              }
              
              
              }, "app/6047", data);
    
}

function file_begin(){
    
	var data = {
			user_id:localStorage.getItem("user_id"),
			manager_id:top.user_name,
			inst_id:top.inst_name,
			customer:$("#customer").val(),
			group_code:$("#group_code").val(),  
			type:'0',
			force:'0',
			coordinate:top.coordinate,
			 			address:top.address_gps,
			 			trandate:get_trandate()
			};
	top.http_comm("6003", data, function(){
	var json=eval("("+msg+")");

	localStorage.setItem("fileno", json.data.fileno);
           	$("#check_button").hide();
           	$("#check_div").show();
               $("#check_end").show();
           })
           
}

function update_address(address){				
	top.address_gps = address;
	$("#address_gps").html(address);			
}
</script>
</head>
    <body>
        <header class="mui-bar mui-bar-nav head_color">
            <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" onclick="back_history();" ></a>
            <h1 class="mui-title">新增零售客户资料</h1>
        </header>
        
       
        <div class="mui-content mui-scroll-wrapper" >
            <div class="mui-scroll" >
            <iframe style="width:100%;border:0;margin-top:25px;" src="map_header.html" mce_src="map_header.html" name="tmp_iframe" id="tmp_iframe"></iframe>
        
                <div id="qy_div" style="background-color: #efeff4;height:100%;margin-top:-25px;">
                    <div class="mui-content-padded" style="margin: 5px;">
                        <form class="mui-input-group">
                            <div class="mui-input-row">
                                <label>客户名称</label>
                                <input type="text" id="customer" placeholder="客户名称">
                            </div>
                            <div class="mui-input-row">
                                <label>证件号码</label>
                                <input type="text" id="group_code" onblur="query_by_no()" placeholder="证件号码" maxlength='18'>
                            </div>
                            <div class="mui-input-row" >
                                <label>联系方式</label>
                                <input type="tel" id="tel_no" placeholder="联系方式" maxlength='11'>
                            </div>
                            <div class="mui-input-row">
                                <label>联系地址</label>
                                <input type="text" placeholder="输入具体地址" id="ls_address">
                            </div>
                        </form>
                    </div>
                    <div class="mui-content-padded" style="margin: 5px;">
                        <form class="mui-input-group" >
                            <div class="mui-input-row">
                                <label>风险分类</label>
                                <input type="text" placeholder="点击选择风险分类" id="risk_type">
                            </div>
                            <div class="mui-input-row">
                                <label>担保方式</label>
                                <input type="text" placeholder="点击选择担保方式" id="guarant_type">
                            </div>
                            <div class="mui-input-row">
                                <label>担保人</label>
                                <input type="text" placeholder="输入具体担保人" id="guarantor">
                            </div>
                        </form>
                    </div>
                    <div class="mui-content-padded" style="margin: 5px;">
                        <form class="mui-input-group" >
                            <div class="mui-input-row">
                                <label>经营实体名称</label>
                                <input type="text" placeholder="输入客户经营实体名称" id="corporation">
                                    </div>
                            <div class="mui-input-row">
                                <label>行业分类</label>
                                <input type="text" placeholder="输入行业分类" id="category">
                                    </div>
                            <div class="mui-input-row">
                                <label>注册地址</label>
                                <input type="text" placeholder="输入注册地址" id="address">
                                    </div>
                        </form>
                    </div>
                        <div style="margin-top:10px;text-align:center;margin-bottom: 30px;" id="save_button">
                        <button type="button" class="mui-btn  mui-btn-primary" style="width:90%" onclick="add_or_modify()">保存</button>
                    </div>
          			<ul class="mui-table-view mui-grid-view mui-grid-9" style="background:rgba(45,45,45,0.2);height:45px;border:0px;border-bottom: 0px solid #2d2d2d;display:none;" >
			            <li class="mui-table-view-cell  mui-col-xs-6" onClick="parent.showNewFrame('add_home.html', 'smask');">
			                   <svg class="icon" aria-hidden="true">
				                        <use xlink:href="#icon-mendianchaxun"></use>
				                    </svg> 
				                   	 在线检查
			              
			             </li>
			             <li class="mui-table-view-cell  mui-col-xs-6" onClick="parent.showNewFrame('add_offline_home.html', 'smask');">
			                   <svg class="icon" aria-hidden="true">
				                        <use xlink:href="#icon-fangyuanchaxun"></use>
				                    </svg>
				                    	离线检查
			                    
			             </li>
					</ul>

                    
                    <div style="height:300px;line-height:300px;color:#fff;text-align:center;">--到底了--</div>
                </div>
            </div>
        </div>
      
        
        <script src="hello-mui/js/mui.min.js"></script>
        
        <script src="hello-mui/js/mui.picker.js"></script>
        <script src="hello-mui/js/mui.poppicker.js"></script>
        <script src="hello-mui/js/city.data.js" type="text/javascript" charset="utf-8"></script>
        <script src="hello-mui/js/city.data-3.js" type="text/javascript" charset="utf-8"></script>
        <script>
            (function($, doc) {
             $.init();
             $.ready(function() {
                     //三级联示例 抵押物地址
                     var cityPicker1 = new $.PopPicker({
                                                       layer: 1
                                                       });
                     cityPicker1.setData(riskData);
               
              
                     var risk_type = doc.getElementById('risk_type');
                     risk_type.addEventListener('tap', function(event) {
                          cityPicker1.show(function(items) {
                               risk_type.value = (items[0] || {}).text;
                               //返回 false 可以阻止选择框的关闭
                               //return false;
                               risk_type_value = (items[0] || {}).value;
                               });
                          }, false);
                     
                     //三级联示例 抵押物地址
                     var cityPicker2 = new $.PopPicker({
                                                       layer: 1
                                                       });
                     cityPicker2.setData(guarantData);
                     
                     
                     var guarant_type = doc.getElementById('guarant_type');
                     guarant_type.addEventListener('tap', function(event) {
                                                cityPicker2.show(function(items) {
                                                                 guarant_type.value = (items[0] || {}).text ;
                                                                 //返回 false 可以阻止选择框的关闭
                                                                 //return false;
                                                                 guarant_type_value = (items[0] || {}).value;
                                                                 });
                                                }, false);
                     
                     
                     //三级联示例 抵押物地址
                     var cityPicker3 = new $.PopPicker({
                                                       layer: 1
                                                       });
                     cityPicker3.setData(categoryData);
                     
                     
                     var category = doc.getElementById('category');
                     category.addEventListener('tap', function(event) {
                                                cityPicker3.show(function(items) {
                                                                 category.value = (items[0] || {}).text;
                                                                 //返回 false 可以阻止选择框的关闭
                                                                 //return false;
                                                                 category_value = (items[0] || {}).value;
                                                                 });
                                                }, false);
                     
                     
                     });
             })(mui, document);
        </script>
    </body>
</html>
