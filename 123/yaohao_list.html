<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title></title>
	<link href="js/lib/bootstrap3.0/bootstrap.css" rel="stylesheet">		
	<link href="css/lib/zzlcss/menu11.css" rel="stylesheet">
    <link rel="stylesheet" href="css/common.css">
	<link rel="stylesheet" href="hello-mui/css/mui.min.css">
	<link rel="stylesheet" href="hello-mui/css/app.css">
<link rel="stylesheet" type="text/css" href="hello-mui/css/icons-extra.css" />
	<script src="hello-mui/js/mui.min.js"></script>
	<script type="text/javascript" src="js/lib/jQuery/jquery-2.0.0.min.js"></script>
	<script type="text/javascript" src="js/lib/bootstrap3.0/bootstrap.min.js"></script>
  
	<script type="text/javascript" src="js/lib/zzljs/menu11_com.js"></script>
       <script src="js/index.js" type="text/javascript" charset="utf-8"></script>
        <style>
		 html, body {
                 position: relative;
                 height: 100%;
             }
         body {
             background: #fff;
             font-family: Helvetica Neue, Helvetica, Arial, sans-serif;
             font-size: 14px;
             color:#000;
             margin: 0;
             padding: 0;
             overflow:auto;
          
         }

		.mui-spinner,
			.mui-spinner-white {
				margin-top: 12px
			}
			.active .mui-spinner-indicator {
				background: #007AFF;
			}
		.div_conditions{       
		    z-index:9998;background-color:rgba(244,244,244,1);width:100%;height:100%;position: fixed;top:0px;
		}
		input[type="date"]:before{
    color:#A9A9A9;
    content:attr(placeholder);
}


input[type="date"].full:before {
    color:black;
    content:""!important;
}
        </style>
 		<script>
			var thisURL; 
			var json;
			var radio_flag = 3;
			var user_type;
			$(function() {
				//调整map高度
				mui.init({
					pullRefresh: {
						container: '#pullrefresh',
						
						down: {		
							height: 50,
							contentinit: '下拉可以刷新',
							contentdown: '下拉可以刷新',
							contentover: '释放立即刷新',
							contentrefresh: '正在刷新...',
							auto:false,
							callback: pulldownRefresh
						}					
					}
                    });
	            mui('.mui-scroll-wrapper').scroll({
	                                             deceleration: 0.0005 //flick 减速系数，系数越大，滚动速度越慢，滚动距离越小，默认值0.0006
	                                             });
	            mui("#pullrefresh").on('tap', '.mui-card', function (event) {
					this.click();
					
					});
	            mui(document.body).on('tap', '.mui-icon-plusempty', function(e) {
	        		this.click();
	        		return false;
	        	});
	            document.querySelector('.mui-table-view.mui-table-view-radio').addEventListener('selected',function(e){
        			var str = e.detail.el.innerText;
        			radio_flag = str.split("-")[0];
        			//radio_flag = e.detail.el.id;
        		});
	            
	            
	            $("#begindate").on("input propertychange",function(){
	                  
	                   if($(this).val().length>0){
	                   		$(this).addClass("full");
	                   }
	                   else{
	                   		$(this).removeClass("full");
	                   }
	            
	              });
	              $("#enddate").on("input propertychange",function(){
	                            
	                   if($(this).val().length>0){
	                   		$(this).addClass("full");
	                   }
	                   else{
	                   		$(this).removeClass("full");
	                   }
	                   
	               });
	            user_type = localStorage.getItem("user_type");
	            if(user_type == 0){
	            	radio_flag = 3; //默认为3，查所有未发送的记录
	            }else{
	            	radio_flag = 0; //默认为0，查所有未发送的记录
	            }
	            
	          //  initPage();				
			});
				
			function initPage(){
				var data = {
						user_id:localStorage.getItem("user_id"),	
						type:radio_flag,
						user_type:localStorage.getItem("user_type"),
						begindate:$("#begindate").val(),
						enddate:$("#enddate").val()
				};			
				
				//top.writelog("6038="+JSON.stringify(data));
				Http_ajax(showList, "app/6038", data);
			}
			/**
			 * 下拉刷新具体业务实现
			 */
			function pulldownRefresh() {
				setTimeout(function() {
					mui('#pullrefresh').pullRefresh().endPulldownToRefresh(); //refresh completed
					initPage();
				//	get_checkinfo_menu();
				//	mui.toast("没有更多信息了");
				}, 1500);
			}
			function showList(msg){
				top.stop_process();
				top.writelog("6038 recv:"+msg);
				json=eval("("+msg+")");		
				
				if(json.data.list.length == 0){
					$("#info").html('');
					mui.toast('没有满足条件的记录');
					return;
				}
				
				var info_html = '';
				for(var i = 0; i < json.data.list.length; i++){
					
					var type = json.data.list[i].type;
					var num = json.data.list[i].fileno;
					top.writelog("num="+num);
					var imgurl;			
						var info_status='';
						var info_star = '';
						var type_name = '';
						var ass_info = '';
						
						if(json.data.list[i].flag == 1){ //个人
							if(json.data.list[i].customer_type == '0'){//新增客户
								type_name = "零售客户-新增";
							}else{
								type_name = "零售客户-存量";
							}
													
						}else{
							
							if(json.data.list[i].customer_type == '0'){//新增客户
								type_name = "企金客户-新增";
							}else{
								type_name = "企金客户-存量";
							}
						}
						top.writelog("fileno="+num+";stat="+json.data.list[i].stat);
						if(json.data.list[i].stat == 0 ){ //未发送短信
							info_status = '当前状态：<font color="#3F813F">还未短信通知客户</font>';
							imgurl = "img/unsend.png";
							if(top.myLevel == '0'){
								ass_info = "具体分派评估公司稍后通知";
							}else{
								ass_info = json.data.list[i].assessmentName;
							}
							
						}else if( json.data.list[i].stat == 2 ){ //已回退
					
							info_status = '被驳回：<font color="#ff6600">'+json.data.list[i].note+'</font>';
							imgurl = "img/beback.png";
							ass_info = json.data.list[i].assessmentName;
						}else{
							if(json.data.list[i].star < 1){
								if(user_type == '1'){
									info_status = '当前状态：<font color="#049FF1">已经短信通知客户，等待客户经理打分</font>';
								}else{
									info_status = '当前状态：<font color="#049FF1">已经短信通知客户，请打分</font>';
								}
								
								imgurl = "img/dafen.png";
							}else{
								info_status = '当前状态：<font color="#43A102">已经处理完成</font>';
								imgurl = "img/finish.png";
							}	
							ass_info = json.data.list[i].assessmentName;
						}
	
			    		info_html += '<div class="mui-card" onclick="getfile_info(\''+num+'\',\''+json.data.list[i].stat+'\',\''+json.data.list[i].flag+'\',\''+json.data.list[i].user_id+'\')"><div class="mui-card-header mui-card-media"><img src="'+imgurl+'" />'					
						+'<div class="mui-media-body">'+type_name+'<p>'+get_time_str(json.data.list[i].trandate)+'</p></div></div>'
						+'<div class="mui-card-content" style="padding-left:50px;">'
						+'<h5 style="color:black;">客户名称：'+json.data.list[i].customer+'</h5>'
						+'<p style="margin:1px;font-size:12px;">流水号：'+num+'</p>'
						+'<p style="margin:1px;font-size:12px;">'+info_status+'</p>'
						+'<p style="margin:1px;font-size:12px;">摇号结果：'+ass_info+'</p>'	
						+'<p style="margin:1px;font-size:12px;">业务机构：'+json.data.list[i].orgnName+'</p>'	
						+'</div></div>'
						+'</div>';
				}
				
				$("#info").html('');
				$("#info").html(info_html+'<div style="height:100;color:#f4f4f4">填充空白</div>');
		
			}
			
			function getfile_info(num, flag, type, userid){
				
				var login_user = localStorage.getItem("user_id");
				top.writelog("num="+num+";flag="+flag+";type="+type+";userid="+userid+";local_user="+login_user);
				if((flag == '2')  && (login_user == userid)){ //被驳回的重新摇号
					if(type == 0){ //企金客户
						showNewFrame('yaohao_edit_qy.html?fileno='+num, 'smask');
					}else if(type == 1){//零售客户
						showNewFrame('yaohao_edit_gr.html?fileno='+num, 'smask');
					}
				}else{
					showNewFrame('yaohao_query.html?fileno='+num, 'smask');
				}
				
			}
			
			function show_conditions(){
				
				$(".div_conditions").show();
			}
			
			function hide_conditions(){
				
				$(".div_conditions").hide();
			}
			
			function search_by_conditions(){
				$(".div_conditions").hide();
				
				var data = {
						user_id:localStorage.getItem("user_id"),	
						type:radio_flag,
						user_type:localStorage.getItem("user_type"),
						begindate:$("#begindate").val(),
						enddate:$("#enddate").val()
				};			
				
				//top.writelog("6038="+JSON.stringify(data));
				Http_ajax(showList, "app/6038", data);
			}
			
			function show_pg(){
				parent.showNewFrame('yaohao.html', 'smask');
			}
		</script>
    </head>
    
<body>
   	<header class="mui-bar mui-bar-nav head_color">
		<a class="mui-icon mui-icon-plusempty mui-pull-left" style="font-size:32px" onclick="show_pg();" ></a>
		<h1 class="mui-title" style="font-weight:bold;">评估摇号</h1>
        <a  class="mui-action-menu mui-icon mui-icon-bars mui-pull-right"  onclick="show_conditions();"></a>
           
	</header>

	<div class="container-fluid">
		<div style="margin-top:-30px;height:30px;line-height:30px;"><span class="mui-spinner"></span>刷新页面</div>
		<div id="pullrefresh" class="mui-content mui-scroll-wrapper" >				
			<div class="mui-scroll top_head" style="background-color: #f4f4f4;">
				<ul  id="info">
			
				</ul>
			</div>
		</div>
	</div>

	 <div class="div_conditions" style="display:none">
	 <!-- 
			<header class="ui-header ui-header-positive ui-border-b">
	            <i class="ui-icon-return" onclick="hide_conditions();"></i>
				<div style="font-size:18px;font-weight:bold;text-align:center;">条件筛选</div>
				<button class="ui-btn" onclick="search_by_conditions();">确认</button>
	        </header>
	  -->
			<header class="mui-bar mui-bar-nav head_color" >
				<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" onclick="hide_conditions();" ></a>
				<h1 class="mui-title" style="font-weight:bold;">条件筛选</h1>
				<div class="mui-btn mui-btn-blue mui-btn-link mui-pull-right" style="color:#000000;font-weight:bold;font-size:16px;margin-top:5px;"><button class="ui-btn" onclick="search_by_conditions();">确认</button></div>
			</header>
			<div class="mui-content" style="margin-top:15px;">
	 			<ul class="mui-table-view mui-table-view-radio">					
					<li class="mui-table-view-cell">
						<a class="mui-navigate-right " id="0">
							0-未处理记录
						</a>
					</li>
					<li class="mui-table-view-cell">
						<a class="mui-navigate-right" id="1">
							1-已发短信记录
						</a>
					</li>
					<li class="mui-table-view-cell">
						<a class="mui-navigate-right" id="2">
							2-回退记录
						</a>
					</li>
					<li class="mui-table-view-cell">
						<a class="mui-navigate-right" id="3">
							3-全部记录
						</a>
					</li>
				</ul>
				<ul>
					<li class="mui-table-view-cell">
						<div class="mui-input-row" style="background:#ffffff">
							<label>开始时间</label>
							<input type="date" placeholder="请选择起始日期" id="begindate" style="height:41px;overflow: hidden;">
						</div>
					</li>
					<li class="mui-table-view-cell">
						<div class="mui-input-row" style="background:#ffffff">
							<label>结束时间</label>
							<input type="date" placeholder="请选择结束日期" id="enddate" style="height:41px;overflow: hidden;">
						</div>
					</li>
				</ul>
				<div style="margin-top:10px;text-align:center;margin-bottom: 300px;">
					<button type="button" class="mui-btn  mui-btn-primary" style="width:90%" onclick="search_by_conditions();">搜索</button>
				</div>
											
      		</div>
      	</div>	
			
</body>
</html>
